<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apple Store - Premium Experience</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Three.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <style>
        html, body {
    max-width: 100%;
    overflow-x: hidden !important;
}

/* Đảm bảo ảnh không phá layout */
img {
    max-width: 100%;
    height: auto;
    display: block;
}

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #000;
            color: #f5f5f7;
            overflow-x: hidden;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1d1d1f;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #424245;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #86868b;
        }
        
        /* Header Styles */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 9999;
            backdrop-filter: blur(20px) saturate(180%);
            background: rgba(0, 0, 0, 0.8);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .menu {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            height: 48px;
            gap: 16px;
        }
        
        .menu a {
            color: #f5f5f7;
            text-decoration: none;
            font-size: 12px;
            font-weight: 400;
            letter-spacing: -0.01em;
            padding: 0 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            white-space: nowrap;
        }
        
        .menu a:hover {
            color: #fff;
        }
        
        .menu a::after {
            content: '';
            position: absolute;
            bottom: -14px;
            left: 50%;
            transform: translateX(-50%) scaleX(0);
            width: 100%;
            height: 2px;
            background: #0071e3;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .menu a:hover::after {
            transform: translateX(-50%) scaleX(1);
        }
        
        .logo {
            font-size: 20px;
            padding: 0 12px !important;
        }
        
        /* Search Container */
        .search-container {
            position: relative;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .search-input {
            width: 0;
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid transparent;
            border-radius: 20px;
            color: #f5f5f7;
            font-size: 13px;
            outline: none;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
        }
        
        .search-container:focus-within .search-input,
        .search-input:not(:placeholder-shown) {
            width: 180px;
            opacity: 1;
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .search-input:focus {
            background: rgba(255, 255, 255, 0.12);
            border-color: #0071e3;
        }
        
        .search-btn {
            background: transparent;
            border: none;
            color: #f5f5f7;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .search-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* Suggestions */
        #suggestions-container {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            width: 320px;
            background: rgba(29, 29, 31, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            z-index: 1000;
        }
        
        #suggestions-list {
            list-style: none;
            max-height: 400px;
            overflow-y: auto;
        }
        
        #suggestions-list li {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.2s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        #suggestions-list li:last-child {
            border-bottom: none;
        }
        
        #suggestions-list li:hover {
            background: rgba(255, 255, 255, 0.08);
        }
        
        .suggestion-item-image {
            width: 40px;
            height: 40px;
            object-fit: contain;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .suggestion-item-name {
            font-size: 13px;
            color: #f5f5f7;
            font-weight: 400;
        }
        
        /* Login Link */
        .login-link {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px !important;
            border-radius: 20px;
            transition: all 0.3s ease;
        }
        
        .login-link:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .login-link span {
            font-size: 12px;
        }
        
        /* Logged In User */
        .logged-in-user {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 12px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            font-size: 12px;
        }
        
        .user-email {
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .logout-btn {
            background: rgba(255, 59, 48, 0.8);
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .logout-btn:hover {
            background: rgba(255, 59, 48, 1);
        }
        
        /* Cart Container */
        .cart-container {
            position: relative;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .cart-container:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .cart-container i {
            font-size: 16px;
        }
        
        .cart-count {
            position: absolute;
            top: 2px;
            right: 2px;
            background: #0071e3;
            color: white;
            font-size: 9px;
            font-weight: 600;
            min-width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2px;
        }
        
    
    </style>
</head>
<body class="bg-black">
    
<div class="fixed top-24 left-6 z-[9990] flex gap-2 group">
    <button onclick="document.querySelector('.filter-panel').classList.toggle('translate-x-full'); document.querySelector('.filter-panel').classList.toggle('-translate-x-full');" 
            class="w-10 h-10 rounded-full bg-zinc-800/80 backdrop-blur text-white border border-white/10 shadow-lg flex items-center justify-center hover:bg-blue-600 transition-all hover:scale-110">
        <i class="fas fa-filter"></i>
    </button>
</div>

<aside class="filter-panel fixed top-[48px] left-0 w-80 h-[calc(100vh-48px)] bg-zinc-900/95 backdrop-blur-xl border-r border-white/10 p-8 overflow-y-auto transform -translate-x-full transition-transform duration-300 z-[9997] shadow-2xl">
    
    <div class="flex justify-between items-center mb-8">
        <h3 class="text-xl font-bold text-white flex items-center gap-3">
            <i class="fas fa-filter text-blue-500"></i> Bộ Lọc
        </h3>
        <button onclick="document.querySelector('.filter-panel').classList.add('-translate-x-full')" class="text-zinc-500 hover:text-white transition-colors">
            <i class="fas fa-chevron-left"></i>
        </button>
    </div>

    <form id="filterForm" class="space-y-8">
        <div class="filter-group">
            <h4 class="text-xs font-bold text-zinc-500 uppercase tracking-widest mb-4">Khoảng Giá</h4>
            <div class="flex flex-wrap gap-2">
                <label class="cursor-pointer group">
                    <input type="checkbox" name="price" value="0-5000000" class="peer sr-only">
                    <span class="block px-3 py-2 rounded-lg text-xs font-medium bg-zinc-800 text-zinc-400 border border-zinc-700 transition-all group-hover:bg-zinc-700 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 shadow-sm">
                        &lt; 5 triệu
                    </span>
                </label>
                <label class="cursor-pointer group">
                    <input type="checkbox" name="price" value="5000000-10000000" class="peer sr-only">
                    <span class="block px-3 py-2 rounded-lg text-xs font-medium bg-zinc-800 text-zinc-400 border border-zinc-700 transition-all group-hover:bg-zinc-700 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 shadow-sm">
                        5 - 10 triệu
                    </span>
                </label>
                <label class="cursor-pointer group">
                    <input type="checkbox" name="price" value="10000000-20000000" class="peer sr-only">
                    <span class="block px-3 py-2 rounded-lg text-xs font-medium bg-zinc-800 text-zinc-400 border border-zinc-700 transition-all group-hover:bg-zinc-700 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 shadow-sm">
                        10 - 20 triệu
                    </span>
                </label>
                <label class="cursor-pointer group">
                    <input type="checkbox" name="price" value="20000000-999999999" class="peer sr-only">
                    <span class="block px-3 py-2 rounded-lg text-xs font-medium bg-zinc-800 text-zinc-400 border border-zinc-700 transition-all group-hover:bg-zinc-700 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 shadow-sm">
                        &gt; 20 triệu
                    </span>
                </label>
            </div>
        </div>

        <div class="filter-group">
            <h4 class="text-xs font-bold text-zinc-500 uppercase tracking-widest mb-4">Loại Sản Phẩm</h4>
            <div class="flex flex-col gap-2">
                <label class="cursor-pointer group flex items-center justify-between p-3 rounded-xl bg-zinc-800/50 hover:bg-zinc-800 border border-transparent hover:border-zinc-700 transition-all">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-blue-500/10 text-blue-400 flex items-center justify-center text-sm">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <span class="text-sm text-zinc-300 group-hover:text-white font-medium">Phone</span>
                    </div>
                    <input type="checkbox" name="category" value="Phone" class="accent-blue-500 w-4 h-4">
                </label>
                
                <label class="cursor-pointer group flex items-center justify-between p-3 rounded-xl bg-zinc-800/50 hover:bg-zinc-800 border border-transparent hover:border-zinc-700 transition-all">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-purple-500/10 text-purple-400 flex items-center justify-center text-sm">
                            <i class="fas fa-tablet-alt"></i>
                        </div>
                        <span class="text-sm text-zinc-300 group-hover:text-white font-medium">iPad</span>
                    </div>
                    <input type="checkbox" name="category" value="iPad" class="accent-blue-500 w-4 h-4">
                </label>

                <label class="cursor-pointer group flex items-center justify-between p-3 rounded-xl bg-zinc-800/50 hover:bg-zinc-800 border border-transparent hover:border-zinc-700 transition-all">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-orange-500/10 text-orange-400 flex items-center justify-center text-sm">
                            <i class="fas fa-laptop"></i>
                        </div>
                        <span class="text-sm text-zinc-300 group-hover:text-white font-medium">Laptop</span>
                    </div>
                    <input type="checkbox" name="category" value="Laptop" class="accent-blue-500 w-4 h-4">
                </label>

                <label class="cursor-pointer group flex items-center justify-between p-3 rounded-xl bg-zinc-800/50 hover:bg-zinc-800 border border-transparent hover:border-zinc-700 transition-all">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-red-500/10 text-red-400 flex items-center justify-center text-sm">
                            <i class="fas fa-clock"></i>
                        </div>
                        <span class="text-sm text-zinc-300 group-hover:text-white font-medium">Watch</span>
                    </div>
                    <input type="checkbox" name="category" value="Watch" class="accent-blue-500 w-4 h-4">
                </label>

                 <label class="cursor-pointer group flex items-center justify-between p-3 rounded-xl bg-zinc-800/50 hover:bg-zinc-800 border border-transparent hover:border-zinc-700 transition-all">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-pink-500/10 text-pink-400 flex items-center justify-center text-sm">
                            <i class="fas fa-headphones"></i>
                        </div>
                        <span class="text-sm text-zinc-300 group-hover:text-white font-medium">HeadPhone</span>
                    </div>
                    <input type="checkbox" name="category" value="HeadPhone" class="accent-blue-500 w-4 h-4">
                </label>
            </div>
        </div>

        <button type="reset" class="w-full py-3 rounded-xl bg-white/5 border border-white/10 text-white font-semibold hover:bg-white/10 hover:text-red-400 transition-colors mt-8">
            <i class="fas fa-undo mr-2"></i> Xóa bộ lọc
        </button>
    </form>
</aside>
    <!-- Header -->
    <header>
        <nav class="menu">
            <a href="#" class="logo">
                <i class="fab fa-apple"></i>
            </a>
            
            <a href="index.html">Store</a>
            <a href="Mac/mac.html">Mac</a>
            <a href="ipad/ipad.html">iPad</a>
            <a href="iphone/iphone.html">iPhone</a>
            <a href="#">Watch</a>
            <a href="#">AirPods</a>
            <a href="#">TV & Home</a>
            <a href="ACCOUNT.html">Member</a>
            <a href="support.html">Support</a>
            
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Tìm kiếm...">
                <button class="search-btn"><i class="fas fa-search"></i></button>
            </div>
            
            <div id="suggestions-container" style="display: none;">
                <ul id="suggestions-list"></ul>
            </div>
            
            <a href="login/login.html" class="login-link">
                <i class="fas fa-user"></i>
                <span>Đăng nhập</span>
            </a>
            
            <div class="cart-container">
                <i class="fas fa-shopping-cart"></i>
                <span class="cart-count">0</span>
            </div>
        </nav>
    </header>

    <!-- Main Container -->
    <div class="w-full" style="margin-top: 48px;">
        <div id="cart-popup" class="hidden fixed top-[48px] right-0 w-full sm:w-[450px] h-[calc(100vh-48px)] bg-zinc-900/95 backdrop-blur-2xl border-l border-white/10 shadow-[-10px_0_30px_rgba(0,0,0,0.5)] z-[9999] flex flex-col transition-all duration-300 translate-x-full">
        <div class="px-6 py-5 border-b border-white/10 flex justify-between items-center bg-zinc-900/50">
            <h3 class="text-xl font-bold text-white tracking-tight">Giỏ hàng <span class="text-zinc-500 text-sm font-normal ml-2 cart-count-display">(0)</span></h3>
            <button onclick="closeCart()" class="text-zinc-400 hover:text-white transition-colors w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10">
                <i class="fas fa-times text-lg"></i>
            </button>
        </div>

        <ul id="cart-items" class="flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar">
            </ul>

        <div class="p-6 border-t border-white/10 bg-zinc-900/80 backdrop-blur-xl mt-auto">
            <div class="flex justify-between items-end mb-4">
                <span class="text-zinc-400 text-sm">Tổng thanh toán:</span>
                <span id="cart-total-display" class="text-2xl font-bold text-blue-500">0₫</span>
            </div>
            <button onclick="window.location.href='checkout.html'" class="w-full py-4 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white font-bold rounded-2xl shadow-lg shadow-blue-500/30 transform hover:scale-[1.02] transition-all duration-200 flex items-center justify-center gap-2">
                Thanh Toán Ngay <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>
        <!-- Search Results Section -->
        <section id="search-results-section" class="search-results-section" style="display: none;">
            <div class="max-w-7xl mx-auto px-6 py-16">
                <h2 class="text-4xl font-bold text-center mb-12 bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
                    Search Results
                </h2>
                <ul id="search-results-list" class="product-grid"></ul>
            </div>
        </section>

        <!-- Hero Section -->
        <div class="hero">
            <img src="images/apple.webp" alt="iPhone 16 Pro Max" class="hero-background-img">
            <div class="hero-overlay"></div>
            <div class="hero-content">
                <h1 class="hero-title">iPhone 16 Pro Max</h1>
                <p class="hero-subtitle">Top performance — Exceptional class</p>
                <a href="iphone/iphone.html" class="hero-btn">
                    Learn more
                    <i class="fas fa-arrow-right ml-2"></i>
                </a>
            </div>
        </div>

        <style>
            /* Search Results Section */
            .search-results-section {
                min-height: 80vh;
                padding-top: 80px;
                background: linear-gradient(180deg, #000 0%, #1d1d1f 100%);
            }
            
            /* Product Grid */
            .product-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 24px;
                list-style: none;
            }
            
            /* Hero Section */
            .hero {
                position: relative;
                width: 100%;
                height: 100vh;
                min-height: 600px;
                display: flex;
                align-items: center;
                justify-content: center;
                overflow: hidden;
                background: #000;
            }
            
            .hero-background-img {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                object-fit: cover;
                object-position: center;
                z-index: 1;
            }
            
            .hero-overlay {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(180deg, 
                    rgba(0, 0, 0, 0.3) 0%, 
                    rgba(0, 0, 0, 0.6) 50%,
                    rgba(0, 0, 0, 0.9) 100%);
                z-index: 2;
            }
            
            .hero-content {
                position: relative;
                z-index: 3;
                text-align: center;
                padding: 0 24px;
                animation: fadeInUp 1s ease-out;
            }
            
            .hero-title {
                font-size: clamp(48px, 8vw, 96px);
                font-weight: 700;
                color: #f5f5f7;
                margin-bottom: 16px;
                letter-spacing: -0.03em;
                line-height: 1.05;
                text-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            }
            
            .hero-subtitle {
                font-size: clamp(18px, 3vw, 28px);
                font-weight: 400;
                color: #d2d2d7;
                margin-bottom: 32px;
                letter-spacing: 0.01em;
                text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            }
            
            .hero-btn {
                display: inline-flex;
                align-items: center;
                padding: 14px 32px;
                background: rgba(0, 113, 227, 0.9);
                backdrop-filter: blur(20px);
                color: white;
                text-decoration: none;
                font-size: 17px;
                font-weight: 500;
                border-radius: 980px;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                border: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .hero-btn:hover {
                background: rgba(0, 113, 227, 1);
                transform: scale(1.05);
                box-shadow: 0 8px 24px rgba(0, 113, 227, 0.4);
            }
            
            .hero-btn i {
                transition: transform 0.3s ease;
            }
            
            .hero-btn:hover i {
                transform: translateX(4px);
            }
            
            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(40px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            /* Product Item Card */
            .product-item {
                background: rgba(29, 29, 31, 0.6);
                backdrop-filter: blur(20px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 18px;
                overflow: hidden;
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                cursor: pointer;
                height: 100%;
                display: flex;
                flex-direction: column;
            }
            
            .product-item:hover {
                transform: translateY(-8px);
                border-color: rgba(0, 113, 227, 0.5);
                box-shadow: 0 20px 40px rgba(0, 113, 227, 0.2);
                background: rgba(29, 29, 31, 0.8);
            }
            
            .product-image {
                position: relative;
                width: 100%;
                height: 280px;
                background: rgba(255, 255, 255, 0.02);
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 24px;
                overflow: hidden;
            }
            
            .product-image img {
                width: 100%;
                height: 100%;
                object-fit: contain;
                transition: transform 0.4s ease;
            }
            
            .product-item:hover .product-image img {
                transform: scale(1.1);
            }
            
            .product-info {
                padding: 20px;
                display: flex;
                flex-direction: column;
                gap: 8px;
                flex: 1;
            }
            
            .product-cat {
                font-size: 11px;
                color: #86868b;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                font-weight: 500;
                text-decoration: none;
            }
            
            .product-name {
                font-size: 18px;
                font-weight: 600;
                color: #f5f5f7;
                text-decoration: none;
                line-height: 1.3;
                margin-bottom: 4px;
            }
            
            .product-name:hover {
                color: #0071e3;
            }
            
            .product-price {
                font-size: 16px;
                font-weight: 500;
                color: #0071e3;
                margin-top: auto;
                margin-bottom: 12px;
            }
            
            .product-rating {
                display: flex;
                align-items: center;
                gap: 8px;
                font-size: 13px;
                margin-bottom: 12px;
            }
            
            .product-rating span:first-child {
                color: #f5a623;
            }
            
            .product-rating .sold {
                color: #86868b;
            }
            
            .product-info button {
                width: 100%;
                padding: 10px;
                background: rgba(0, 113, 227, 0.1);
                border: 1px solid rgba(0, 113, 227, 0.3);
                border-radius: 10px;
                color: #0071e3;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.3s ease;
                margin-bottom: 8px;
            }
            
            .product-info button:hover {
                background: rgba(0, 113, 227, 0.2);
                border-color: rgba(0, 113, 227, 0.5);
                transform: scale(1.02);
            }
            
            .btn-payment {
                background: rgba(0, 113, 227, 0.9) !important;
                border: 1px solid rgba(0, 113, 227, 1) !important;
                color: white !important;
            }
            
            .btn-payment:hover {
                background: rgba(0, 113, 227, 1) !important;
                box-shadow: 0 4px 12px rgba(0, 113, 227, 0.4);
            }
            
            /* Responsive */
            @media (max-width: 768px) {
                .hero-title {
                    font-size: 48px;
                }
                
                .hero-subtitle {
                    font-size: 20px;
                }
                
                .product-grid {
                    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
                    gap: 16px;
                }
                
                .menu {
                    overflow-x: auto;
                    padding: 0 12px;
                }
                
                .menu a {
                    font-size: 11px;
                }
            }
        </style>

        <!-- Accordion Section -->
        <section class="new-accordion-design">
            <div class="max-w-7xl mx-auto px-6 py-20">
                <h2 class="text-5xl font-bold text-center mb-16 bg-gradient-to-r from-blue-400 via-purple-500 to-pink-500 bg-clip-text text-transparent">
                    Seamless Ecosystem
                </h2>
                <div class="accordion-wrapper">
                    <div class="accordion-left-panel">
                        <div class="accordion-item-new active" data-image-src="images/ipad_iphone_e15076279.jpg">
                            <button class="accordion-header-new">
                                <div class="accordion-icon">
                                    <i class="fab fa-apple"></i>
                                </div>
                                <span>iPad and iPhone</span>
                                <i class="fas fa-chevron-right accordion-arrow"></i>
                            </button>
                            <div class="accordion-content-new">
                                <p>iPad is the perfect device to bring the content you shoot on your iPhone to life in a creative space. You can shoot videos and photos on your iPhone, then use the iPad's large screen to edit, add visual effects, and more. You can also pick up right where you left off with Handoff.</p>
                            </div>
                        </div>

                        <div class="accordion-item-new" data-image-src="images/ipad_mac_ff7009943.jpg">
                            <button class="accordion-header-new">
                                <div class="accordion-icon">
                                    <i class="fas fa-laptop"></i>
                                </div>
                                <span>iPad and Mac</span>
                                <i class="fas fa-chevron-right accordion-arrow"></i>
                            </button>
                            <div class="accordion-content-new">
                                <p>The ability to work seamlessly between two devices allows for increased productivity and limitless creativity.</p>
                            </div>
                        </div>

                        <div class="accordion-item-new" data-image-src="images/ipad_watch_e19064f33.jpg">
                            <button class="accordion-header-new">
                                <div class="accordion-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <span>iPad and Apple Watch</span>
                                <i class="fas fa-chevron-right accordion-arrow"></i>
                            </button>
                            <div class="accordion-content-new">
                                <p>Track your health and fitness with Apple Watch, then view your data visually and in detail on the large iPad screen for a more complete view.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-right-panel">
                        <div class="accordion-image-wrapper">
                            <img src="images/ipad_iphone_e15076279.jpg" alt="Product showcase" id="accordion-main-image">
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <style>
            /* Accordion Section */
            .new-accordion-design {
                background: linear-gradient(180deg, #000 0%, #1d1d1f 50%, #000 100%);
                padding: 60px 0;
            }
            
            .accordion-wrapper {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 60px;
                align-items: center;
            }
            
            .accordion-left-panel {
                display: flex;
                flex-direction: column;
                gap: 16px;
            }
            
            .accordion-item-new {
                background: rgba(29, 29, 31, 0.4);
                backdrop-filter: blur(20px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 16px;
                overflow: hidden;
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            }
            
            .accordion-item-new:hover,
            .accordion-item-new.active {
                background: rgba(29, 29, 31, 0.8);
                border-color: rgba(0, 113, 227, 0.5);
                box-shadow: 0 8px 32px rgba(0, 113, 227, 0.2);
            }
            
            .accordion-header-new {
                width: 100%;
                display: flex;
                align-items: center;
                gap: 16px;
                padding: 20px 24px;
                background: transparent;
                border: none;
                color: #f5f5f7;
                font-size: 18px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                text-align: left;
            }
            
            .accordion-icon {
                width: 48px;
                height: 48px;
                background: rgba(0, 113, 227, 0.1);
                border-radius: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                color: #0071e3;
                transition: all 0.3s ease;
            }
            
            .accordion-item-new.active .accordion-icon {
                background: rgba(0, 113, 227, 0.2);
                transform: scale(1.1);
            }
            
            .accordion-arrow {
                margin-left: auto;
                font-size: 14px;
                color: #86868b;
                transition: transform 0.3s ease;
            }
            
            .accordion-item-new.active .accordion-arrow {
                transform: rotate(90deg);
                color: #0071e3;
            }
            
            .accordion-content-new {
                padding: 0 24px 20px 88px;
                display: none;
                color: #d2d2d7;
                font-size: 15px;
                line-height: 1.6;
                animation: slideDown 0.3s ease;
            }
            
            .accordion-item-new.active .accordion-content-new {
                display: block;
            }
            
            @keyframes slideDown {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            .accordion-right-panel {
                position: relative;
                height: 600px;
            }
            
            .accordion-image-wrapper {
                position: relative;
                width: 100%;
                height: 100%;
                border-radius: 20px;
                overflow: hidden;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            }
            
            #accordion-main-image {
                width: 100%;
                height: 100%;
                object-fit: cover;
                transition: opacity 0.4s ease;
            }
            
            /* Comparison Section */
            .iphone-comparison-2 {
                background: linear-gradient(180deg, #000 0%, #1d1d1f 100%);
                padding: 80px 0;
            }
            
            .section-title {
                font-size: clamp(32px, 5vw, 48px);
                font-weight: 700;
                text-align: center;
                margin-bottom: 48px;
                background: linear-gradient(135deg, #0071e3 0%, #00c6fb 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }
            
            .iphone-selection-container {
                max-width: 1200px;
                margin: 0 auto 48px;
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 24px;
                padding: 0 24px;
            }
            
            .iphone-selection {
                background: rgba(29, 29, 31, 0.6);
                backdrop-filter: blur(20px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 16px;
                padding: 24px;
            }
            
            .iphone-selection h3 {
                font-size: 16px;
                font-weight: 600;
                color: #f5f5f7;
                margin-bottom: 16px;
            }
            
            .iphone-selection select {
                width: 100%;
                padding: 14px 16px;
                background: rgba(255, 255, 255, 0.08);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 12px;
                color: #f5f5f7;
                font-size: 15px;
                cursor: pointer;
                transition: all 0.3s ease;
                outline: none;
            }
            
            .iphone-selection select:hover {
                background: rgba(255, 255, 255, 0.12);
                border-color: rgba(255, 255, 255, 0.3);
            }
            
            .iphone-selection select:focus {
                border-color: #0071e3;
                box-shadow: 0 0 0 3px rgba(0, 113, 227, 0.2);
            }
            
            .comparison-area {
                max-width: 1200px;
                margin: 0 auto;
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 32px;
                padding: 0 24px;
            }
            
            .iphone-details {
                background: rgba(29, 29, 31, 0.6);
                backdrop-filter: blur(20px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 20px;
                padding: 32px;
                transition: all 0.4s ease;
            }
            
            .iphone-details:hover {
                transform: translateY(-4px);
                border-color: rgba(0, 113, 227, 0.5);
                box-shadow: 0 12px 40px rgba(0, 113, 227, 0.2);
            }
            
            .iphone-details h3 {
                font-size: 24px;
                font-weight: 700;
                color: #f5f5f7;
                margin-bottom: 12px;
            }
            
            .iphone-details p {
                color: #d2d2d7;
                font-size: 14px;
                line-height: 1.6;
                margin-bottom: 24px;
            }
            
            .iphone-3d-container {
                width: 100%;
                height: 400px;
                background: rgba(255, 255, 255, 0.02);
                border-radius: 16px;
                overflow: hidden;
                position: relative;
            }
            
            /* Responsive Accordion */
            @media (max-width: 1024px) {
                .accordion-wrapper {
                    grid-template-columns: 1fr;
                }
                
                .accordion-right-panel {
                    height: 400px;
                }
            }
            
            @media (max-width: 768px) {
                .accordion-content-new {
                    padding-left: 24px;
                }
                
                .iphone-selection-container,
                .comparison-area {
                    grid-template-columns: 1fr;
                }
            }
        </style>

        <!-- iPhone Comparison Section -->
        <section class="iphone-comparison-2">
            <h2 class="section-title">Live iPhone Comparison Mode</h2>
            
            <div class="iphone-selection-container">
                <div class="iphone-selection">
                    <h3>Select iPhone model 1:</h3>
                    <select id="modelSelect1" onchange="updatePreview()">
                        <option value="iphone16ProMax">iPhone 16 Pro Max</option>
                        <option value="iphone15ProMax">iPhone 15 Pro Max</option>
                        <option value="iphone14ProMax">iPhone 14 Pro Max</option>
                        <option value="iphone13">iPhone 13</option>
                    </select>
                </div>

                <div class="iphone-selection">
                    <h3>Select iPhone model 2:</h3>
                    <select id="modelSelect2" onchange="updatePreview()">
                        <option value="iphone16ProMax">iPhone 16 Pro Max</option>
                        <option value="iphone15ProMax">iPhone 15 Pro Max</option>
                        <option value="iphone14ProMax">iPhone 14 Pro Max</option>
                        <option value="iphone13">iPhone 13</option>
                    </select>
                </div>
            </div>

            <div class="comparison-area">
                <div class="iphone-details" id="iphone1">
                    <h3 id="iphone1Title">iPhone 16 Pro Max</h3>
                    <p id="iphone1Details">Detailed specifications of iPhone 16 Pro Max.</p>
                    <div id="iphone1Model" class="iphone-3d-container"></div>
                </div>

                <div class="iphone-details" id="iphone2">
                    <h3 id="iphone2Title">iPhone 15 Pro Max</h3>
                    <p id="iphone2Details">Detailed specifications of iPhone 15 Pro Max.</p>
                    <div id="iphone2Model" class="iphone-3d-container"></div>
                </div>
            </div>
        </section>

        <!-- Best Selling Products Section -->
        <div class="item">
            <div class="max-w-7xl mx-auto px-6 py-20">
                <h2 class="text-5xl font-bold text-center mb-16 bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500 bg-clip-text text-transparent">
                    Best Selling Products
                </h2>
                <ul class="product-list">
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="Airpods Pro 2" data-price="5,000,000₫" data-desc="Noise-cancelling wireless earbuds, H2 chip" data-spec="H2 chip, ANC, Bluetooth 5.3, MagSafe Charging" data-img="images/airpod2.jpg"><div class="product-image"><img src="images/airpod2.jpg" alt="AirPods Pro 2"></div><div class="product-info"><a href="#" class="product-cat">HeadPhone</a><a href="#" class="product-name">AirPods Pro 2</a><div class="product-price">5,000,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a62', 'Airpods Pro 2', '5,000,000₫', 'images/airpod2.jpg')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('AirPods Pro 2', '5,000,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="iPhone 7 Plus" data-price="22,000,000₫" data-desc="iPhone 7 Plus with dual camera, smooth performance" data-spec="5.5in Display, 3GB RAM, A10 Fusion, 2900mAh Battery" data-images="images/iphone7plus.jpeg,images/7plusgold.webp,images/7plus_silver.jpeg,images/7plus_black.jpg,images/7plus-jetblack.jpg,images/7plus-red.webp" data-color-map='[{"name":"Rose Gold","code":"#E0BFB8","img":"images/iphone7plus.jpeg"},{"name":"Gold","code":"#D4AF37","img":"images/7plusgold.webp"},{"name":"Silver","code":"#C0C0C0","img":"images/7plus_silver.jpeg"},{"name":"Black","code":"#343434","img":"images/7plus_black.jpg"},{"name":"Jet Black","code":"#000000","img":"images/7plus-jetblack.jpg"},{"name":"(PRODUCT)RED","code":"#BF2032","img":"images/7plus-red.webp"}]'><div class="product-image"><img src="images/iphone7plus.jpeg" alt="iPhone 7 Plus"></div><div class="product-info"><a href="#" class="product-cat">Phone</a><a href="#" class="product-name">iPhone 7 Plus</a><div class="product-price">22,000,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a63', 'iPhone 7 Plus', '22,000,000₫', 'images/iphone7plus.jpeg')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('iPhone 7 Plus', '22,000,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="iPhone 8 Plus" data-price="5,000,000₫" data-desc="Glass design, wireless charging, stable performance" data-spec="5.5in Retina HD Display, A11 Bionic, 3GB RAM, 2691mAh Battery" data-images="images/iphone8plus.webp,images/8plus-silver.png,images/8plus-grey.png,images/8plus-red.webp" data-color-map='[{"name":"Gold","code":"#F5DEB3","img":"images/iphone8plus.webp"},{"name":"Silver","code":"#EAEAEA","img":"images/8plus-silver.png"},{"name":"Space Gray","code":"#5C5C5E","img":"images/8plus-grey.png"},{"name":"(PRODUCT)RED","code":"#BF2032","img":"images/8plus-red.webp"}]'><div class="product-image"><img src="images/iphone8plus.webp" alt="iPhone 8 Plus"></div><div class="product-info"><a href="#" class="product-cat">Phone</a><a href="#" class="product-name">iPhone 8 Plus</a><div class="product-price">5,000,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a64', 'iPhone 8 Plus', '5,000,000₫', 'images/iphone8plus.webp')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('iPhone 8 Plus', '5,000,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="iPhone 11" data-price="10,000,000₫" data-desc="iPhone 11 with dual camera, long battery life, youthful colors" data-spec="6.1in LCD Display, A13 Bionic, 4GB RAM, 3110mAh Battery" data-images="images/iphone11.jpg,images/11 white.jpg,images/iphone11yellow.webp" data-color-map='[{"name":"Green","code":"#D2E7D6","img":"images/iphone11.jpg"},{"name":"White","code":"#F9F6F2","img":"images/11 white.jpg"},{"name":"Yellow","code":"#F3E5AB","img":"images/iphone11yellow.webp"}]'><div class="product-image"><img src="images/iphone11.jpg" alt="iPhone 11"></div><div class="product-info"><a href="#" class="product-cat">Phone</a><a href="#" class="product-name">iPhone 11</a><div class="product-price">10,000,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a65', 'iPhone 11','10,000,000₫','images/iphone11.jpg')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('iPhone 11', '10,000,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="iPhone 12" data-price="20,000,000₫" data-desc="iPhone 12 with 6.1 inch screen, A14 Bionic chip" data-spec="Screen: 6.1 inch OLED, Chip: A14 Bionic, RAM: 4GB, Battery: 2815mAh" data-images="images/iphone 12 black.png,images/iphone-12-tim-1-600x600.jpg,images/iphone 12 red.png" data-color-map='[{"name":"Black","code":"#3B3B3B","img":"images/iphone 12 black.png"},{"name":"Purple","code":"#B8AFE6","img":"images/iphone-12-tim-1-600x600.jpg"},{"name":"(PRODUCT)RED","code":"#BF2032","img":"images/iphone 12 red.png"}]'><div class="product-image"><img src="images/iphone 12 black.png" alt="iPhone 12"></div><div class="product-info"><a href="#" class="product-cat">Phone</a><a href="#" class="product-name">iPhone 12</a><div class="product-price">20,000,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a67', 'iPhone 12','20,000,000₫','images/iphone-12-tim-1-600x600.jpg')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('iPhone 12', '20,000,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="iPhone 12 Pro" data-price="25,000,000₫" data-desc="iPhone 12 Pro with Pro camera, LiDAR" data-spec="Display: 6.1 inch OLED, Chip: A14 Bionic, RAM: 6GB, Camera: 3 lenses, Battery: 2815mAh" data-images="images/12 gold.webp,images/12 pro white.png,images/iphone 12 black.png,images/(600x600)_crop_iphone-12-pro-xtmobile.webp" data-color-map='[{"name":"Gold","code":"#F5E8C8","img":"images/12 gold.webp"},{"name":"White","code":"#EAEAEA","img":"images/12 pro white.png"},{"name":"Black","code":"#5C5C5E","img":"images/iphone 12 black.png"},{"name":"Pacific Blue","code":"#2E4755","img":"images/(600x600)_crop_iphone-12-pro-xtmobile.webp"}]'><div class="product-image"><img src="images/12 gold.webp" alt="iPhone 12 Pro"></div><div class="product-info"><a href="#" class="product-cat">Phone</a><a href="#" class="product-name">iPhone 12 Pro</a><div class="product-price">25,000,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a68', 'iPhone 12 Pro','25,000,000₫','images/(600x600)_crop_iphone-12-pro-xtmobile.webp')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('iPhone 12 Pro', '25,000,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="iPhone 14 Pro Max" data-price="26,500,000₫" data-desc="Dynamic Island, chip A16 Bionic" data-spec="Display: 6.7 inch OLED, Chip: A16 Bionic, RAM: 6GB, Camera: 48MP, Pin: 4323mAh" data-img="images/iphone14promax.webp"><div class="product-image"><img src="images/iphone14promax.webp" alt="iPhone 14 Pro Max"></div><div class="product-info"><a href="#" class="product-cat">Phone</a><a href="#" class="product-name">iPhone 14 Pro Max</a><div class="product-price">26,500,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a69', 'iPhone 14 Pro Max','26,500,000₫','images/iphone14promax.webp')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('iPhone 14 Pro Max', '26,500,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="iPhone 15 Pro Max" data-price="27,500,000₫" data-desc="Khung titan, chip A17 Pro" data-spec="Display: 6.7 inch OLED, Chip: A17 Pro, RAM: 8GB, Camera: 48MP, Pin: 4422mAh" data-images="images/iphone15promax.webp,images/15prmxanh.webp,images/15prmtitantrang.jpg" data-color-map='[{"name":"Titan Tự Nhiên","code":"#8A8A8D","img":"images/iphone15promax.webp"},{"name":"Titan Xanh","code":"#2E3A48","img":"images/15prmxanh.webp"},{"name":"Titan Trắng","code":"#F5F5F7","img":"images/15prmtitantrang.jpg"}]'><div class="product-image"><img src="images/iphone15promax.webp" alt="iPhone 15 Pro Max"></div><div class="product-info"><a href="#" class="product-cat">Phone</a><a href="#" class="product-name">iPhone 15 Pro Max</a><div class="product-price">27,500,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a6a', 'iPhone 15 Pro Max','27,500,000₫','images/iphone15promax.webp')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('iPhone 15 Pro Max', '27,500,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="iPhone 16 Pro Max" data-price="31,000,000₫" data-desc="Display bigger, chip A18 Pro" data-spec="Display: 6.9 inch OLED, Chip: A18 Pro, RAM: 8GB, Camera: 48MP, Pin: 4700mAh" data-images="images/16 pro max đen.webp,images/16 pro max gold.png,images/16 pro max silver.jpg,images/16 pro max white.webp" data-color-map='[{"name":"Space Black","code":"#4A4A4A","img":"images/16 pro max đen.webp"},{"name":"Gold","code":"#D4AF37","img":"images/16 pro max gold.png"},{"name":"Silver","code":"#E3E4E6","img":"images/16 pro max silver.jpg"},{"name":"Titanium White","code":"#F5F5F7","img":"images/16 pro max white.webp"}]'><div class="product-image"><img src="images/16 pro max đen.webp" alt="iPhone 16 Pro Max"></div><div class="product-info"><a href="#" class="product-cat">Phone</a><a href="#" class="product-name">iPhone 16 Pro Max</a><div class="product-price">31,000,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a6b', 'iPhone 16 Pro Max','31,000,000₫','images/16 pro max đen.webp')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('iPhone 16 Pro Max', '31,000,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="MacBook Air 15 M3" data-price="32,000,000₫" data-desc="Display bigger 15 inch, chip M3 strong, thin and light design" data-spec="M3 8-core CPU, 10-core GPU, 8GB RAM (base), 256GB SSD (base), Display 15.3\", Wi-Fi 6E" data-images="images/air15 black.webp,images/air 15 gold.webp,images/macbook air 15 grey.webp" data-color-map='[{"name":"Midnight","code":"#2E3642","img":"images/air15 black.webp"},{"name":"Starlight","code":"#F0E4D3","img":"images/air 15 gold.webp"},{"name":"Space Gray","code":"#808285","img":"images/macbook air 15 grey.webp"}]'><div class="product-image"><img src="images/air15 black.webp" alt="MacBook Air 15 M3"></div><div class="product-info"><a href="#" class="product-cat">Laptop</a><a href="#" class="product-name">MacBook Air 15" M3</a><div class="product-price">32,000,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a6c', 'MacBook Air 15 M3', '32,000,000₫', 'images/air15 black.webp')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('MacBook Air 15 M3', '32,000,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="iMac 24 M3" data-price="33,000,000₫" data-desc="Gorgeous All-in-One Computer, chip M3, Display Retina 4.5K" data-spec="M3 8-core CPU, 8/10-core GPU, 8GB RAM (base), 256GB SSD (base), Display 23.5\" 4.5K Retina" data-img="images/imac24.jpg"><div class="product-image"><img src="images/imac24.jpg" alt="iMac 24 M3"></div><div class="product-info"><a href="#" class="product-cat">Desktop</a><a href="#" class="product-name">iMac 24" M3</a><div class="product-price">33,000,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a6d', 'iMac 24 M3', '33,000,000₫', 'images/imac24.jpg')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('iMac 24 M3', '33,000,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="Mac mini M2" data-price="15,000,000₫" data-desc="Compact desktop, impressive performance with M2 chip" data-spec="M2 8-core CPU, 10-core GPU, 8GB RAM (base), 256GB SSD (base), Wi-Fi 6E, Thunderbolt 4" data-img="images/Mac mini M2.jpg"><div class="product-image"><img src="images/Mac mini M2.jpg" alt="Mac mini M2"></div><div class="product-info"><a href="#" class="product-cat">Desktop</a><a href="#" class="product-name">Mac mini M2</a><div class="product-price">15,000,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a6e', 'Mac mini M2', '15,000,000₫', 'images/Mac mini M2.jpg')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('Mac mini M2', '15,000,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="iPhone SE (3rd gen)" data-price="10,000,000₫" data-desc="Powerful performance in compact design, chip A15 Bionic" data-spec="Display 4.7\" Retina HD, A15 Bionic, RAM 4GB, Camera 12MP, Touch ID, 5G" data-images="images/iphone se 3rd gold.webp,images/iphone se 3rd red.jpg,images/iphone se 3rd black.jpg" data-color-map='[{"name":"Gold","code":"#F5DEB3","img":"images/iphone se 3rd gold.webp"},{"name":"(PRODUCT)RED","code":"#BF2032","img":"images/iphone se 3rd red.jpg"},{"name":"Midnight","code":"#3B3B3B","img":"images/iphone se 3rd black.jpg"}]'><div class="product-image"><img src="images/iphone se 3rd gold.webp" alt="iPhone SE 3rd gen"></div><div class="product-info"><a href="#" class="product-cat">Phone</a><a href="#" class="product-name">iPhone SE (3rd gen)</a><div class="product-price">10,000,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a6f', 'iPhone SE (3rd gen)', '10,000,000₫', 'images/iphone se 3rd gold.webp')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('iPhone SE (3rd gen)', '10,000,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="iPhone 13" data-price="15,000,000₫" data-desc="Powerful A15 Bionic chip, improved dual camera, good battery life" data-spec="Display 6.1\" Super Retina XDR, A15 Bionic, RAM 4GB, Double camera 12MP, Pin 3240mAh" data-images="images/iphone 13 blue.jpg,images/iphone13 rose.webp,images/iphone 13 black.jpg,images/iphone 13 gold.webp" data-color-map='[{"name":"Blue","code":"#2E77A5","img":"images/iphone 13 blue.jpg"},{"name":"Pink","code":"#F7D7D9","img":"images/iphone13 rose.webp"},{"name":"Midnight","code":"#3B3B3B","img":"images/iphone 13 black.jpg"},{"name":"Gold","code":"#FFD700","img":"images/iphone 13 gold.webp"}]'><div class="product-image"><img src="images/iphone 13 blue.jpg" alt="iPhone 13"></div><div class="product-info"><a href="#" class="product-cat">Phone</a><a href="#" class="product-name">iPhone 13</a><div class="product-price">15,000,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a70', 'iPhone 13','15,000,000₫','images/iphone 13 blue.jpg')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('iPhone 13', '15,000,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="iPhone 14" data-price="17,000,000₫" data-desc="Collision detection, upgraded camera, chip A15 Bionic" data-spec="Display 6.1\" Super Retina XDR, A15 Bionic (5-core GPU), RAM 6GB, Double camera, Crash Detection" data-images="images/iphone 14 red.jpg,images/iphone 14 yellow.webp,images/iphone14 black.jpg,images/iphone 14 purple.webp,images/ipone14 gold.jpg,images/iphone 14 grey.jpg" data-color-map='[{"name":"(PRODUCT)RED","code":"#BF2032","img":"images/iphone 14 red.jpg"},{"name":"Yellow","code":"#F3E5AB","img":"images/iphone 14 yellow.webp"},{"name":"Midnight","code":"#3B3B3B","img":"images/iphone14 black.jpg"},{"name":"Purple","code":"#E5DDEA","img":"images/iphone 14 purple.webp"},{"name":"Gold","code":"#FFD700","img":"images/ipone14 gold.jpg"},{"name":"Grey","code":"#808285","img":"images/iphone 14 grey.jpg"}]'><div class="product-image"><img src="images/iphone 14 red.jpg" alt="iPhone 14"></div><div class="product-info"><a href="#" class="product-cat">Phone</a><a href="#" class="product-name">iPhone 14</a><div class="product-price">17,000,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a71', 'iPhone 14','17,000,000₫','images/iphone 14 red.jpg')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('iPhone 14', '17,000,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="iPhone 15 Plus" data-price="23,000,000₫" data-desc="Display lớn 6.7 inch, Dynamic Island, camera 48MP, USB-C" data-spec="Display 6.7\" Super Retina XDR, A16 Bionic, RAM 6GB, Double camera 48MP, Pin lớn, USB-C" data-images="images/iphonee15 plus black.png,images/iphone15 plus green.webp,images/iphone 15 plus rose.webp,images/iphone 15 plus blue.jpg" data-color-map='[{"name":"Black","code":"#3B3B3B","img":"images/iphonee15 plus black.png"},{"name":"Green","code":"#D2E7D6","img":"images/iphone15 plus green.webp"},{"name":"Pink","code":"#FADEE4","img":"images/iphone 15 plus rose.webp"},{"name":"Blue","code":"#A7C4DD","img":"images/iphone 15 plus blue.jpg"}]'><div class="product-image"><img src="images/iphonee15 plus black.png" alt="iPhone 15 Plus"></div><div class="product-info"><a href="#" class="product-cat">Phone</a><a href="#" class="product-name">iPhone 15 Plus</a><div class="product-price">23,000,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a72', 'iPhone 15 Plus','23,000,000₫','images/iphonee15 plus black.png')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('iPhone 15 Plus', '23,000,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="AirPods (3rd gen)" data-price="4,000,000₫" data-desc="New design, Spatial sound, Adaptive EQ" data-spec="H1 chip, Spatial Audio, Adaptive EQ, IPX4, 6 hour battery life" data-img="images/AirPods (3rd gen).jpg"><div class="product-image"><img src="images/AirPods (3rd gen).jpg" alt="AirPods 3rd gen"></div><div class="product-info"><a href="#" class="product-cat">HeadPhone</a><a href="#" class="product-name">AirPods (3rd gen)</a><div class="product-price">4,000,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a73', 'AirPods (3rd gen)','4,000,000₫','images/AirPods (3rd gen).jpg')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('AirPods (3rd gen)', '4,000,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="AirPods Max" data-price="13,000,000₫" data-desc="Premium over-ear headphones, active noise cancellation, Hi-Fi sound" data-spec="H1 chip (each side), ANC, Transparency Mode, Spatial Audio, Digital Crown" data-img="images/airpodmax.png"><div class="product-image"><img src="images/airpodmax.png" alt="AirPods Max"></div><div class="product-info"><a href="#" class="product-cat">HeadPhone</a><a href="#" class="product-name">AirPods Max</a><div class="product-price">13,000,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a74', 'AirPods Max','13,000,000₫','images/airpodmax.png')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('AirPods Max', '13,000,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="Apple Watch Series 9" data-price="10,000,000₫" data-desc="Powerful S9 chip, Double Tap gesture, Brighter display" data-spec="S9 SiP, Double Tap, Display Always-On sáng hơn, ECG, Blood Oxygen, GPS" data-images="images/watch series 9 rose.webp,images/watch series 9 gold.jpeg,images/watch series 9 blue.webp,images/watch seris 9 black.jpg" data-color-map='[{"name":"Pink","code":"#FADEE4","img":"images/watch series 9 rose.webp"},{"name":"Gold","code":"#F5E8C8","img":"images/watch series 9 gold.jpeg"},{"name":"Blue","code":"#A8C5DD","img":"images/watch series 9 blue.webp"},{"name":"Midnight","code":"#3B3B3B","img":"images/watch seris 9 black.jpg"}]'><div class="product-image"><img src="images/watch series 9 rose.webp" alt="Apple Watch Series 9"></div><div class="product-info"><a href="#" class="product-cat">Watch</a><a href="#" class="product-name">Apple Watch Series 9</a><div class="product-price">10,000,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a75', 'Apple Watch Series 9','10,000,000₫','images/watch series 9 rose.webp')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('Apple Watch Series 9', '10,000,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="Apple Watch Ultra 2" data-price="20,000,000₫" data-desc="Most durable, longest battery life, professional features for sports" data-spec="S9 SiP, Double Tap, Titanium Case, Dual Frequency GPS, 100m Water Resistant, Dive Computer" data-images="images/black.webp,images/ultra green.png,images/orange.jpg" data-color-map='[{"name":"Black/Grey Trail Loop","code":"#4B4B4B","img":"images/black.webp"},{"name":"Green Alpine Loop","code":"#3B4A3F","img":"images/ultra green.png"},{"name":"Orange Ocean Band","code":"#F48853","img":"images/orange.jpg"}]'><div class="product-image"><img src="images/black.webp" alt="Apple Watch Ultra 2"></div><div class="product-info"><a href="#" class="product-cat">Watch</a><a href="#" class="product-name">Apple Watch Ultra 2</a><div class="product-price">20,000,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a76', 'Apple Watch Ultra 2','20,000,000₫','images/black.webp')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('Apple Watch Ultra 2', '20,000,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="Apple Watch SE (2nd gen)" data-price="6,000,000₫" data-desc="Great value, essential features, S8 chip" data-spec="S8 SiP, Crash Detection, Heart Rate Monitor, 50m Water Resistant, Family Setup" data-images="images/se black.jpg,images/se gold.jpeg" data-color-map='[{"name":"Midnight","code":"#3B3B3B","img":"images/se black.jpg"},{"name":"Starlight","code":"#F0E4D3","img":"images/se gold.jpeg"}]'><div class="product-image"><img src="images/se black.jpg" alt="Apple Watch SE 2nd gen"></div><div class="product-info"><a href="#" class="product-cat">Watch</a><a href="#" class="product-name">Apple Watch SE (2nd gen)</a><div class="product-price">6,000,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a77', 'Apple Watch SE (2nd gen)','6,000,000₫','images/se black.jpg')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('Apple Watch SE (2nd gen)', '6,000,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="iPad Air (M2)" data-price="15,000,000₫" data-desc="Powerful M2 chip, thin and light design, supports Apple Pencil Pro" data-spec="M2 chip, Display Liquid Retina 11 13\",horizontal front camera, Touch ID, USB-C" data-images="images/ipad air m2 gold.jpg,images/ipad air m2 blue.jpg" data-color-map='[{"name":"Starlight","code":"#F0E4D3","img":"images/ipad air m2 gold.jpg"},{"name":"Blue","code":"#A8C5DD","img":"images/ipad air m2 blue.jpg"}]'><div class="product-image"><img src="images/ipad air m2 gold.jpg" alt="iPad Air M2"></div><div class="product-info"><a href="#" class="product-cat">iPad</a><a href="#" class="product-name">iPad Air (M2)</a><div class="product-price">15,000,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a78', 'iPad Air (M2)','15,000,000₫','images/ipad air m2 gold.jpg')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('iPad Air (M2)', '15,000,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="iPad Pro (M4)" data-price="25,000,000₫" data-desc="Breakthrough M4 Chip, Ultra-thin OLED Tandem Display, Top Performance" data-spec="M4 chip, Display Ultra Retina XDR (Tandem OLED) 11 13\", Super thin, Face ID, USB-C (Thunderbolt)" data-images="images/ipadprom4.jpg,images/ipad pro black.webp" data-color-map='[{"name":"White","code":"#F6F6F7","img":"images/ipadprom4.jpg"},{"name":"Black","code":"#242424","img":"images/ipad pro black.webp"}]'><div class="product-image"><img src="images/ipadprom4.jpg" alt="iPad Pro M4"></div><div class="product-info"><a href="#" class="product-cat">iPad</a><a href="#" class="product-name">iPad Pro (M4)</a><div class="product-price">25,000,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a79', 'iPad Pro (M4)','25,000,000₫','images/ipadprom4.jpg')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('iPad Pro (M4)', '25,000,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="Apple TV 4K (3rd gen)" data-price="3,500,000₫" data-desc="Ultimate 4K HDR entertainment, A15 Bionic chip, new Siri Remote" data-spec="A15 Bionic, 4K Dolby Vision & HDR10+, tvOS, Wi-Fi + Ethernet (model Advanced), Siri Remote (USB-C)" data-img="images/appletv4k.jpg"><div class="product-image"><img src="images/appletv4k.jpg" alt="Apple TV 4K 3rd gen"></div><div class="product-info"><a href="#" class="product-cat">TV & Home</a><a href="#" class="product-name">Apple TV 4K (3rd gen)</a><div class="product-price">3,500,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a7a', 'Apple TV 4K (3rd gen)','3,500,000₫','images/appletv4k.jpg')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('Apple TV 4K (3rd gen)', '3,500,000₫')">Buy</button></div></div></li>
                    
                    <li><div class="product-item" onclick="showProductDetails(this)" data-name="HomePod (2nd gen)" data-price="7,500,000₫" data-desc="Vivid Hi-Fi sound, smart home integration, S7 chip" data-spec="S7 chip, Spatial audio, Temperature/humidity sensor, Thread, Matter, Siri" data-img="images/homepod2.jpg"><div class="product-image"><img src="images/homepod2.jpg" alt="HomePod 2nd gen"></div><div class="product-info"><a href="#" class="product-cat">TV & Home</a><a href="#" class="product-name">HomePod (2nd gen)</a><div class="product-price">7,500,000₫</div><div class="product-rating"><span>★★★★★</span><span class="sold">Sold 2K</span></div><button onclick="event.stopPropagation(); addToCart('681df98bd08345b0a0e66a7b', 'HomePod (2nd gen)','7,500,000₫','images/homepod2.jpg')">Add to cart</button><button class="btn-payment" onclick="event.stopPropagation(); openPaymentFormIndex('HomePod (2nd gen)', '7,500,000₫')">Buy</button></div></div></li>
                </ul>
            </div>
        </div>

        <style>
            /* Product List Styling */
            .product-list {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 24px;
                list-style: none;
                padding: 0;
                margin: 0;
            }
        </style>

        <!-- Payment Modal -->
        <div id="payment-modal-overlay-index" class="payment-modal-overlay-index">
            <div id="payment-content-modal-index" class="payment-content-modal-index">
                <div class="payment-modal-header-index">
                    <h3>Order Information</h3>
                    <button type="button" class="payment-modal-close-btn-index" onclick="closePaymentFormIndex()">&times;</button>
                </div>
                <div class="payment-modal-body-index">
                    <form id="paymentFormIndex">
                        <section>
                            <h3>Buyer Information</h3>
                            <div class="form-group">
                                <label for="recipient-name-index">Buyer's name <span class="required">*</span></label>
                                <input type="text" id="recipient-name-index" required>
                            </div>
                            <div class="form-group">
                                <label for="recipient-phone-index">Phone Number <span class="required">*</span></label>
                                <input type="tel" id="recipient-phone-index" required>
                            </div>
                            <div class="form-group">
                                <label for="recipient-address-index">Address <span class="required">*</span></label>
                                <input type="text" id="recipient-address-index" required>
                            </div>
                            <div class="form-group">
                                <label for="recipient-notes-index">Detail Note</label>
                                <textarea id="recipient-notes-index" rows="2"></textarea>
                            </div>
                        </section>

                        <section>
                            <h3>Payment Method</h3>
                            <div class="payment-option">
                                <input type="radio" id="cod-payment-index" name="payment-method-index" value="COD" checked>
                                <label for="cod-payment-index"><i class="fa fa-truck"></i> Shipping COD (COD)</label>
                            </div>
                            <div class="payment-option">
                                <input type="radio" id="credit-payment-index" name="payment-method-index" value="Credit Card">
                                <label for="credit-payment-index"><i class="fa fa-credit-card"></i> Credit card</label>
                            </div>
                        </section>

                        <section class="order-summary">
                            <div class="voucher-section-index">
                                <label for="voucher-select-index">Apply Voucher</label>
                                <select id="voucher-select-index" class="voucher-select-index" onchange="applyVoucherIndex()">
                                    <option value="0" data-code="">-- Select Voucher --</option>
                                </select>
                            </div>

                            <div class="order-total">
                                <div>
                                    <span>Price:</span>
                                    <span id="original-price-index">0₫</span>
                                </div>
                                <div class="discount-row-index" id="discount-row-index" style="display: none;">
                                    <span>Discount:</span>
                                    <span id="discount-amount-index">-0₫</span>
                                </div>
                                <div class="total-final">
                                    <span>Total:</span>
                                    <span id="total-amount-index">0₫</span>
                                </div>
                            </div>
                            <h3>Your order</h3>
                            <div id="payment-product-name-index"></div>
                            <div id="payment-product-price-index"></div>
                        </section>

                        <div class="form-footer">
                            <button type="submit" class="btn-submit-payment">Buy Now</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <style>
            /* Payment Modal */
            .payment-modal-overlay-index {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.85);
                backdrop-filter: blur(10px);
                z-index: 10000;
                overflow-y: auto;
            }
            
            .payment-modal-overlay-index.active {
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
            }
            
            .payment-content-modal-index {
                background: rgba(29, 29, 31, 0.98);
                backdrop-filter: blur(40px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 20px;
                max-width: 600px;
                width: 100%;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            }
            
            .payment-modal-header-index {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 24px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .payment-modal-header-index h3 {
                font-size: 24px;
                font-weight: 700;
                color: #f5f5f7;
            }
            
            .payment-modal-close-btn-index {
                width: 36px;
                height: 36px;
                background: rgba(255, 255, 255, 0.08);
                border: none;
                border-radius: 50%;
                color: #f5f5f7;
                font-size: 24px;
                cursor: pointer;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .payment-modal-close-btn-index:hover {
                background: rgba(255, 59, 48, 0.8);
                transform: rotate(90deg);
            }
            
            .payment-modal-body-index {
                padding: 24px;
            }
            
            .payment-modal-body-index section {
                margin-bottom: 32px;
            }
            
            .payment-modal-body-index h3 {
                font-size: 18px;
                font-weight: 600;
                color: #f5f5f7;
                margin-bottom: 16px;
            }
            
            .form-group {
                margin-bottom: 20px;
            }
            
            .form-group label {
                display: block;
                font-size: 14px;
                font-weight: 500;
                color: #d2d2d7;
                margin-bottom: 8px;
            }
            
            .required {
                color: #ff3b30;
            }
            
            .form-group input,
            .form-group textarea,
            .voucher-select-index {
                width: 100%;
                padding: 12px 16px;
                background: rgba(255, 255, 255, 0.08);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 10px;
                color: #f5f5f7;
                font-size: 14px;
                transition: all 0.3s ease;
                outline: none;
            }
            
            .form-group input:focus,
            .form-group textarea:focus,
            .voucher-select-index:focus {
                background: rgba(255, 255, 255, 0.12);
                border-color: #0071e3;
                box-shadow: 0 0 0 3px rgba(0, 113, 227, 0.2);
            }
            
            .payment-option {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 16px;
                background: rgba(255, 255, 255, 0.05);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 12px;
                margin-bottom: 12px;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            
            .payment-option:hover {
                background: rgba(255, 255, 255, 0.08);
                border-color: rgba(0, 113, 227, 0.5);
            }
            
            .payment-option input[type="radio"] {
                width: 20px;
                height: 20px;
                cursor: pointer;
            }
            
            .payment-option label {
                flex: 1;
                cursor: pointer;
                font-size: 14px;
                color: #f5f5f7;
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .voucher-section-index {
                margin-bottom: 20px;
            }
            
            .voucher-section-index label {
                display: block;
                font-size: 14px;
                font-weight: 600;
                color: #d2d2d7;
                margin-bottom: 8px;
            }
            
            .order-total {
                background: rgba(0, 113, 227, 0.1);
                border: 1px solid rgba(0, 113, 227, 0.3);
                border-radius: 12px;
                padding: 16px;
                margin-bottom: 20px;
            }
            
            .order-total > div {
                display: flex;
                justify-content: space-between;
                margin-bottom: 8px;
                font-size: 14px;
                color: #d2d2d7;
            }
            
            .total-final {
                font-size: 20px !important;
                font-weight: 700 !important;
                color: #0071e3 !important;
                padding-top: 12px;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
                margin-top: 8px !important;
            }
            
            .btn-submit-payment {
                width: 100%;
                padding: 16px;
                background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%);
                border: none;
                border-radius: 12px;
                color: white;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            
            .btn-submit-payment:hover {
                transform: scale(1.02);
                box-shadow: 0 8px 24px rgba(0, 113, 227, 0.4);
            }
        </style>

        <!-- Product Detail Modal -->
        <div id="popup-container" class="popup-container">
            <div id="popup">
                <div class="modal-content-left">
                    <div class="image-gallery">
                        <img id="modalMainImg" src="" alt="Main Product Image">
                        <button class="gallery-nav prev" onclick="changeImage(-1)">&#10094;</button>
                        <button class="gallery-nav next" onclick="changeImage(1)">&#10095;</button>
                    </div>
                    <div id="thumbnail-container" class="thumbnail-container"></div>
                </div>
                <div class="modal-content-right">
                    <h2 id="modalName"></h2>
                    <p id="modalPrice"></p>
                    <div id="modalColorSelector" class="color-selector"></div>
                    <p id="modalDesc"></p>
                    <ul id="modalSpec"></ul>
                    <button class="btn btn-modal-close" onclick="closeModal()">Close</button>
                </div>
                <button class="modal-close-top" onclick="closeModal()">&times;</button>
            </div>
        </div>

        <style>
            /* Product Detail Modal */
            .popup-container {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                backdrop-filter: blur(10px);
                z-index: 10000;
                overflow-y: auto;
                padding: 20px;
            }
            
            .popup-container.active {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            #popup {
                background: rgba(29, 29, 31, 0.98);
                backdrop-filter: blur(40px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 24px;
                max-width: 1200px;
                width: 100%;
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 40px;
                padding: 40px;
                position: relative;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            }
            
            .modal-close-top {
                position: absolute;
                top: 20px;
                right: 20px;
                width: 40px;
                height: 40px;
                background: rgba(255, 255, 255, 0.08);
                border: none;
                border-radius: 50%;
                color: #f5f5f7;
                font-size: 24px;
                cursor: pointer;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10;
            }
            
            .modal-close-top:hover {
                background: rgba(255, 59, 48, 0.8);
                transform: rotate(90deg);
            }
            
            .image-gallery {
                position: relative;
                width: 100%;
                height: 400px;
                background: rgba(255, 255, 255, 0.02);
                border-radius: 16px;
                overflow: hidden;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            #modalMainImg {
                max-width: 100%;
                max-height: 100%;
                object-fit: contain;
            }
            
            .gallery-nav {
                position: absolute;
                top: 50%;
                transform: translateY(-50%);
                width: 40px;
                height: 40px;
                background: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 50%;
                color: white;
                font-size: 18px;
                cursor: pointer;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .gallery-nav:hover {
                background: rgba(0, 113, 227, 0.8);
                border-color: rgba(0, 113, 227, 1);
            }
            
            .gallery-nav.prev {
                left: 10px;
            }
            
            .gallery-nav.next {
                right: 10px;
            }
            
            .thumbnail-container {
                display: flex;
                gap: 12px;
                margin-top: 16px;
                overflow-x: auto;
                padding: 8px 0;
            }
            
            .thumbnail-container img {
                width: 80px;
                height: 80px;
                object-fit: contain;
                background: rgba(255, 255, 255, 0.05);
                border: 2px solid transparent;
                border-radius: 12px;
                cursor: pointer;
                transition: all 0.3s ease;
                padding: 8px;
            }
            
            .thumbnail-container img:hover,
            .thumbnail-container img.active {
                border-color: #0071e3;
                background: rgba(0, 113, 227, 0.1);
            }
            
            .modal-content-right h2 {
                font-size: 32px;
                font-weight: 700;
                color: #f5f5f7;
                margin-bottom: 12px;
            }
            
            #modalPrice {
                font-size: 24px;
                font-weight: 600;
                color: #0071e3;
                margin-bottom: 20px;
            }
            
            .color-selector {
                margin-bottom: 20px;
            }
            
            .color-selector-label {
                font-size: 14px;
                font-weight: 600;
                color: #d2d2d7;
                margin-bottom: 12px;
            }
            
            .swatch-container {
                display: flex;
                gap: 12px;
                flex-wrap: wrap;
            }
            
            .color-swatch {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                cursor: pointer;
                border: 3px solid transparent;
                transition: all 0.3s ease;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            }
            
            .color-swatch:hover,
            .color-swatch.active {
                border-color: #0071e3;
                transform: scale(1.1);
            }
            
            #modalDesc {
                font-size: 15px;
                color: #d2d2d7;
                line-height: 1.6;
                margin-bottom: 20px;
            }
            
            #modalSpec {
                list-style: none;
                padding: 0;
                margin-bottom: 24px;
            }
            
            #modalSpec li {
                padding: 10px 16px;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 8px;
                margin-bottom: 8px;
                font-size: 14px;
                color: #d2d2d7;
                border-left: 3px solid #0071e3;
            }
            
            .btn-modal-close {
                width: 100%;
                padding: 14px;
                background: rgba(255, 255, 255, 0.08);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 12px;
                color: #f5f5f7;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            
            .btn-modal-close:hover {
                background: rgba(255, 255, 255, 0.12);
                border-color: rgba(255, 255, 255, 0.3);
            }
            
            @media (max-width: 968px) {
                #popup {
                    grid-template-columns: 1fr;
                    padding: 24px;
                }
            }
        </style>

        <!-- Cart Popup -->

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-container">
                <div class="footer-main">
                    <div class="footer-column">
                        <h4 class="footer-heading">Shop and Learn</h4>
                        <ul class="footer-links">
                            <li><a href="#">Store</a></li>
                            <li><a href="#">Mac</a></li>
                            <li><a href="#">iPad</a></li>
                            <li><a href="#">iPhone</a></li>
                            <li><a href="#">Watch</a></li>
                            <li><a href="#">AirPods</a></li>
                            <li><a href="#">TV & Home</a></li>
                            <li><a href="#">Accessories</a></li>
                        </ul>
                    </div>

                    <div class="footer-column">
                        <h4 class="footer-heading">Services & Support</h4>
                        <ul class="footer-links">
                            <li><a href="#">Apple Music</a></li>
                            <li><a href="#">Apple TV+</a></li>
                            <li><a href="#">iCloud</a></li>
                            <li><a href="#">Manage Your Apple ID</a></li>
                            <li><a href="#">Support</a></li>
                        </ul>
                        <h4 class="footer-heading" style="margin-top: 24px;">Policies</h4>
                        <ul class="footer-links">
                            <li><a href="#">Warranty Policy</a></li>
                            <li><a href="#">Return Policy</a></li>
                            <li><a href="#">Privacy Policy</a></li>
                            <li><a href="#">Installment Policy</a></li>
                        </ul>
                    </div>

                    <div class="footer-column">
                        <h4 class="footer-heading">About Us</h4>
                        <ul class="footer-links">
                            <li><a href="#">Newsroom</a></li>
                            <li><a href="#">Apple Leadership</a></li>
                            <li><a href="#">Career Opportunities</a></li>
                            <li><a href="#">Investors</a></li>
                            <li><a href="#">Contact Apple</a></li>
                        </ul>
                        <h4 class="footer-heading" style="margin-top: 24px;">Contact</h4>
                        <ul class="footer-links">
                            <li><i class="fas fa-phone-alt"></i> 0962923329</li>
                            <li><i class="fas fa-envelope"></i> nthanhtat51@gmail.com</li>
                            <li><i class="fas fa-map-marker-alt"></i> 123 ABC Street, XYZ City</li>
                        </ul>
                    </div>

                    <div class="footer-column">
                        <h4 class="footer-heading">Stay Connected</h4>
                        <p>Get the latest on new products, promotions, and more.</p>
                        <form class="newsletter-form">
                            <input type="email" placeholder="Enter your email">
                            <button type="submit" aria-label="Submit email"><i class="fas fa-paper-plane"></i></button>
                        </form>
                        <div class="footer-social">
                            <a href="#" class="social-icon" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                            <a href="#" class="social-icon" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                            <a href="#" class="social-icon" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                            <a href="#" class="social-icon" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        </div>
                    </div>
                </div>

                <div class="footer-secondary">
                    <div class="footer-legal">
                        <p>© 2025 Apple Clone. All rights reserved.</p>
                        <a href="#">Privacy Policy</a>
                        <a href="#">Terms of Use</a>
                        <a href="#">Sales Policy</a>
                        <a href="#">Legal</a>
                        <a href="#">Site Map</a>
                    </div>
                    <div class="footer-payment">
                        <img src="images/payment-methods.png" alt="Accepted Payment Methods">
                    </div>
                </div>
            </div>
        </footer>

        <style>
            /* Footer */
            .footer {
                background: linear-gradient(180deg, #1d1d1f 0%, #000 100%);
                border-top: 1px solid rgba(255, 255, 255, 0.1);
                padding: 60px 0 32px;
                margin-top: 80px;
            }
            
            .footer-container {
                max-width: 1400px;
                margin: 0 auto;
                padding: 0 24px;
            }
            
            .footer-main {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 48px;
                margin-bottom: 48px;
                padding-bottom: 48px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .footer-column {
                display: flex;
                flex-direction: column;
                gap: 16px;
            }
            
            .footer-heading {
                font-size: 14px;
                font-weight: 600;
                color: #f5f5f7;
                margin-bottom: 8px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
            
            .footer-links {
                list-style: none;
                padding: 0;
                margin: 0;
            }
            
            .footer-links li {
                margin-bottom: 10px;
            }
            
            .footer-links a,
            .footer-links li {
                color: #86868b;
                text-decoration: none;
                font-size: 13px;
                transition: color 0.3s ease;
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .footer-links a:hover {
                color: #f5f5f7;
            }
            
            .footer-column p {
                color: #86868b;
                font-size: 13px;
                line-height: 1.6;
                margin-bottom: 16px;
            }
            
            .newsletter-form {
                display: flex;
                gap: 8px;
                margin-bottom: 20px;
            }
            
            .newsletter-form input {
                flex: 1;
                padding: 12px 16px;
                background: rgba(255, 255, 255, 0.08);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 10px;
                color: #f5f5f7;
                font-size: 13px;
                outline: none;
                transition: all 0.3s ease;
            }
            
            .newsletter-form input:focus {
                background: rgba(255, 255, 255, 0.12);
                border-color: #0071e3;
            }
            
            .newsletter-form button {
                padding: 12px 16px;
                background: rgba(0, 113, 227, 0.8);
                border: none;
                border-radius: 10px;
                color: white;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            
            .newsletter-form button:hover {
                background: rgba(0, 113, 227, 1);
                transform: scale(1.05);
            }
            
            .footer-social {
                display: flex;
                gap: 12px;
            }
            
            .social-icon {
                width: 40px;
                height: 40px;
                background: rgba(255, 255, 255, 0.08);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                color: #86868b;
                text-decoration: none;
                transition: all 0.3s ease;
            }
            
            .social-icon:hover {
                background: rgba(0, 113, 227, 0.2);
                border-color: #0071e3;
                color: #0071e3;
                transform: translateY(-2px);
            }
            
            .footer-secondary {
                display: flex;
                justify-content: space-between;
                align-items: center;
                flex-wrap: wrap;
                gap: 24px;
            }
            
            .footer-legal {
                display: flex;
                flex-wrap: wrap;
                gap: 16px;
                align-items: center;
            }
            
            .footer-legal p {
                color: #86868b;
                font-size: 12px;
                margin: 0;
            }
            
            .footer-legal a {
                color: #86868b;
                text-decoration: none;
                font-size: 12px;
                transition: color 0.3s ease;
            }
            
            .footer-legal a:hover {
                color: #f5f5f7;
            }
            
            .footer-payment img {
                height: 32px;
                opacity: 0.6;
            }
            
            @media (max-width: 768px) {
                .footer-main {
                    grid-template-columns: 1fr;
                    gap: 32px;
                }
                
                .footer-secondary {
                    flex-direction: column;
                    text-align: center;
                }
            }
        </style>

        <!-- Chat Bubble & Window -->
        <div id="chat-bubble" onclick="toggleChat()">
            <i class="fas fa-comment-dots"></i>
        </div>

        <div id="chat-window">
            <div class="chat-header">
                <div class="chat-header-info">
                    <i class="fab fa-apple"></i>
                    <span>Apple Support AI</span>
                </div>
                <span class="close-btn" onclick="toggleChat()">✕</span>
            </div>
            <div class="chat-messages" id="messages-area">
                <div class="msg bot">Xin chào! Em là trợ lý ảo. Em có thể giúp gì cho anh/chị ạ?</div>
            </div>
            <div class="chat-input">
                <input type="text" id="chat-input-text" placeholder="Nhập câu hỏi..." onkeypress="if(event.key==='Enter') sendChat()">
                <button onclick="sendChat()"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>

        <style>
            /* Chat Bubble */
            #chat-bubble {
                position: fixed;
                bottom: 32px;
                right: 32px;
                width: 64px;
                height: 64px;
                background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 28px;
                cursor: pointer;
                box-shadow: 0 8px 24px rgba(0, 113, 227, 0.4);
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                z-index: 9998;
            }
            
            #chat-bubble:hover {
                transform: scale(1.1);
                box-shadow: 0 12px 32px rgba(0, 113, 227, 0.6);
            }
            
            #chat-bubble i {
                animation: pulse 2s infinite;
            }
            
            @keyframes pulse {
                0%, 100% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.1);
                }
            }
            
            /* Chat Window */
            #chat-window {
                display: none;
                position: fixed;
                bottom: 112px;
                right: 32px;
                width: 400px;
                height: 550px;
                background: rgba(29, 29, 31, 0.98);
                backdrop-filter: blur(40px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
                flex-direction: column;
                overflow: hidden;
                z-index: 9999;
                animation: slideUp 0.3s ease-out;
            }
            
            @keyframes slideUp {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            .chat-header {
                background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%);
                padding: 20px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                color: white;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .chat-header-info {
                display: flex;
                align-items: center;
                gap: 12px;
                font-size: 16px;
                font-weight: 600;
            }
            
            .chat-header-info i {
                font-size: 24px;
            }
            
            .close-btn {
                width: 32px;
                height: 32px;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.3s ease;
                font-size: 18px;
            }
            
            .close-btn:hover {
                background: rgba(255, 255, 255, 0.3);
                transform: rotate(90deg);
            }
            
            .chat-messages {
                flex: 1;
                padding: 20px;
                overflow-y: auto;
                display: flex;
                flex-direction: column;
                gap: 12px;
            }
            
            .msg {
                max-width: 80%;
                padding: 12px 16px;
                border-radius: 16px;
                font-size: 14px;
                line-height: 1.5;
                animation: messageSlide 0.3s ease-out;
            }
            
            @keyframes messageSlide {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            .msg.bot {
                align-self: flex-start;
                background: rgba(0, 113, 227, 0.15);
                border: 1px solid rgba(0, 113, 227, 0.3);
                color: #f5f5f7;
                border-radius: 16px 16px 16px 4px;
            }
            
            .msg.user {
                align-self: flex-end;
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                color: #f5f5f7;
                border-radius: 16px 16px 4px 16px;
            }
            
            .chat-input {
                padding: 16px;
                display: flex;
                gap: 12px;
                background: rgba(0, 0, 0, 0.3);
                border-top: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .chat-input input {
                flex: 1;
                padding: 12px 16px;
                background: rgba(255, 255, 255, 0.08);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 12px;
                color: #f5f5f7;
                font-size: 14px;
                outline: none;
                transition: all 0.3s ease;
            }
            
            .chat-input input:focus {
                background: rgba(255, 255, 255, 0.12);
                border-color: #0071e3;
            }
            
            .chat-input button {
                width: 44px;
                height: 44px;
                background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%);
                border: none;
                border-radius: 12px;
                color: white;
                cursor: pointer;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .chat-input button:hover {
                transform: scale(1.05);
                box-shadow: 0 4px 12px rgba(0, 113, 227, 0.4);
            }
            
            @media (max-width: 768px) {
                #chat-window {
                    width: calc(100vw - 32px);
                    right: 16px;
                    bottom: 96px;
                }
                
                #chat-bubble {
                    right: 16px;
                    bottom: 16px;
                }
            }
        </style>

    </div>

    <!-- JavaScript - Part 1: Product Data & Filter Functions -->
    <script>
        let allProducts = [];
        let currentImageIndex = 0;
        let currentImageSet = [];
        let currentColorMap = [];

        async function fetchAllProducts() {
            try {
                const imagePrefix = 'https://project3-icy1.onrender.com/';

                const rawProducts = [
                    // Phone (Phone)
                    { name: 'iPhone 7 Plus', category: 'Phone', price: 22000000, image: 'images/iphone7plus.jpeg' },
                    { name: 'iPhone 8 Plus', category: 'Phone', price: 5000000, image: 'images/iphone8plus.webp' },
                    { name: 'iPhone 11', category: 'Phone', price: 10000000, image: 'images/iphone11.jpg' },
                    { name: 'iPhone SE (3rd gen)', category: 'Phone', price: 10000000, image: 'images/iphone se 3rd gold.webp' },
                    { name: 'iPhone 12', category: 'Phone', price: 20000000, image: 'images/iphone 12 black.png' },
                    { name: 'iPhone 12 Pro', category: 'Phone', price: 25000000, image: 'images/12 gold.webp' },
                    { name: 'iPhone 13', category: 'Phone', price: 15000000, image: 'images/iphone 13 blue.jpg' },
                    { name: 'iPhone 14', category: 'Phone', price: 17000000, image: 'images/iphone 14 red.jpg' },
                    { name: 'iPhone 14 Pro Max', category: 'Phone', price: 26500000, image: 'images/iphone14promax.webp' },
                    { name: 'iPhone 15 Plus', category: 'Phone', price: 23000000, image: 'images/iphonee15 plus black.png' },
                    { name: 'iPhone 15 Pro Max', category: 'Phone', price: 27500000, image: 'images/iphone15promax.webp' },
                    { name: 'iPhone 16 Pro Max', category: 'Phone', price: 31000000, image: 'images/16 pro max đen.webp' },

                    // Headphones (HeadPhone)
                    { name: 'AirPods (3rd gen)', category: 'HeadPhone', price: 4000000, image: 'images/AirPods (3rd gen).jpg' },
                    { name: 'Airpods Pro 2', category: 'HeadPhone', price: 5000000, image: 'images/airpod2.jpg' },
                    { name: 'AirPods Max', category: 'HeadPhone', price: 13000000, image: 'images/airpodmax.png' },

                    // Watches
                    { name: 'Apple Watch SE (2nd gen)', category: 'Watch', price: 6000000, image: 'images/se black.jpg' },
                    { name: 'Apple Watch Series 9', category: 'Watch', price: 10000000, image: 'images/watch series 9 rose.webp' },
                    { name: 'Apple Watch Ultra 2', category: 'Watch', price: 20000000, image: 'images/black.webp' },

                    // iPad
                    { name: 'iPad Air (M2)', category: 'iPad', price: 15000000, image: 'images/ipad air m2 gold.jpg' },
                    { name: 'iPad Pro (M4)', category: 'iPad', price: 25000000, image: 'images/ipadprom4.jpg' },

                    // Laptop (Mac)
                    { name: 'MacBook Air 15" M3', category: 'Laptop', price: 32000000, image: 'images/air15 black.webp' },

                    // Desktop computers
                    { name: 'iMac 24" M3', category: 'Desktop', price: 33000000, image: 'images/imac24.jpg' },
                    { name: 'Mac mini M2', category: 'Desktop', price: 15000000, image: 'images/Mac mini M2.jpg' },

                    // TV & Home
                    { name: 'Apple TV 4K (3rd gen)', category: 'TV & Home', price: 3500000, image: 'images/appletv4k.jpg' },
                    { name: 'HomePod (2nd gen)', category: 'TV & Home', price: 7500000, image: 'images/homepod2.jpg' }
                ];

                allProducts = rawProducts.map(product => ({...product, image: imagePrefix + product.image}));
            } catch (error) {
                console.error("Lỗi khi tải danh sách sản phẩm:", error);
                const productList = document.getElementById('search-results-list');
                if (productList) productList.innerHTML = '<p>Unable to load products.</p>';
            }
        }

        function displayProducts(productsToDisplay) {
            const productList = document.getElementById('search-results-list');
            const searchResultsSection = document.getElementById('search-results-section');
            const mainContentElements = [
                document.querySelector('.hero'),
                document.querySelector('.new-accordion-design'),
                document.querySelector('.iphone-comparison-2'),
                document.querySelector('.item')
            ];

            if (!productList || !searchResultsSection) {
                console.error("Search result container not found!");
                return;
            }

            productList.innerHTML = ''; 

            mainContentElements.forEach(el => {
                if (el) el.style.display = 'none';
            });
            searchResultsSection.style.display = 'block';

            if (productsToDisplay.length === 0) {
                productList.innerHTML = '<p style="grid-column: 1 / -1; text-align: center;">No matching products found.</p>';
                return;
            }

            productsToDisplay.forEach(product => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <div class="product-item">
                        <div class="product-image">
                            <img src="${product.image}" alt="${product.name}">
                        </div>
                        <div class="product-info">
                            <a href="#" class="product-cat">${product.category}</a>
                            <a href="#" class="product-name">${product.name}</a>
                            <div class="product-price">${product.price.toLocaleString('vi-VN')}₫</div>
                            <button>Add to cart</button>
                        </div>
                    </div>
                `;
                li.querySelector('button').addEventListener('click', (e) => {
                    e.stopPropagation();
                    addToCart(product.name, product.category, product.price.toLocaleString('vi-VN') + '₫', product.image);
                });
                
                productList.appendChild(li);
            });
        }

        function applyFilters() {
            const form = document.getElementById('filterForm');
            const formData = new FormData(form);
            const selectedCategories = formData.getAll('category');
            const selectedPrices = formData.getAll('price');
            let filteredProducts = allProducts;

            if (selectedCategories.length > 0) {
                filteredProducts = filteredProducts.filter(product => 
                    selectedCategories.includes(product.category)
                );
            }

            if (selectedPrices.length > 0) {
                filteredProducts = filteredProducts.filter(product => {
                    return selectedPrices.some(range => {
                        const [min, max] = range.split('-').map(Number);
                        return product.price >= min && product.price <= max;
                    });
                });
            }
            
            displayProducts(filteredProducts);
        }

        function resetFiltersAndShowMainContent() {
            const searchResultsSection = document.getElementById('search-results-section');
            const mainContentElements = [
                document.querySelector('.hero'),
                document.querySelector('.new-accordion-design'),
                document.querySelector('.iphone-comparison-2'),
                document.querySelector('.item')
            ];

            if (searchResultsSection) searchResultsSection.style.display = 'none';
            mainContentElements.forEach(el => {
                if (el) el.style.display = ''; 
            });
        }
        
        const filterForm = document.getElementById('filterForm');
        if (filterForm) {
            filterForm.addEventListener('change', applyFilters);
            filterForm.addEventListener('reset', () => {
                setTimeout(() => {
                    resetFiltersAndShowMainContent();
                }, 0);
            });
        }
        
        fetchAllProducts();
    </script>

    <!-- JavaScript - Part 2: Authentication & Cart Functions -->
    <script>
        // Authentication Functions
        function saveLoginData(userData) {
            localStorage.setItem('accessToken', userData.accessToken);
            localStorage.setItem('user', JSON.stringify(userData));
        }

        function getAuthToken() {
            return localStorage.getItem('accessToken');
        }

        function logout() {
            localStorage.removeItem('accessToken');
            localStorage.removeItem('user');
        }

        function updateLoginStatusUI() {
            const token = getAuthToken();
            const userJSON = localStorage.getItem('user');
            const loginLink = document.querySelector('.login-link');
            
            if (token && userJSON && loginLink) {
                try {
                    const user = JSON.parse(userJSON);
                    
                    loginLink.style.display = 'none';

                    const loggedInContainer = document.createElement('div');
                    loggedInContainer.className = 'logged-in-user';
                    loggedInContainer.innerHTML = `
                        <i class="fas fa-user-circle"></i>
                        <span class="user-email">${user.email}</span>
                        <button id="logout-button" class="logout-btn">Đăng xuất</button>
                    `;
                    
                    const cartContainer = document.querySelector('.cart-container');
                    if (cartContainer) {
                        cartContainer.parentNode.insertBefore(loggedInContainer, cartContainer);
                    }

                    const logoutButton = document.getElementById('logout-button');
                    if (logoutButton) {
                        logoutButton.addEventListener('click', () => {
                            logout();
                            alert('Bạn đã đăng xuất thành công.');
                            window.location.reload();
                        });
                    }

                } catch(e) {
                    console.error("Lỗi xử lý thông tin user:", e);
                    loginLink.style.display = 'flex';
                }
            }
        }

        // Cart Functions
        async function addToCart(productId, name, price, image_url) {
            const token = getAuthToken();
            if (!token) {
                alert("Bạn cần đăng nhập để thêm sản phẩm vào giỏ hàng!");
                return;
            }
            const numericPrice = parseFloat(String(price).replace(/[^\d]/g, ''));
            try {
                const response = await fetch('https://project3-icy1.onrender.com/api/cart/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'token': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        productId: productId,
                        quantity: 1,
                        name: name,
                        price: numericPrice,
                        image_url: image_url
                    })
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || "Có lỗi xảy ra");
                }
                const updatedCart = await response.json();
                alert(`Đã thêm "${name}" vào giỏ hàng!`);
                updateCartCount(updatedCart.items);
            } catch (error) {
                console.error("Lỗi khi thêm vào giỏ:", error);
                alert("Lỗi: " + error.message);
            }
        }

async function openCart() {
            const token = getAuthToken();
            if (!token) {
                alert("Vui lòng đăng nhập để xem giỏ hàng.");
                return;
            }
            
            try {
                const response = await fetch('https://project3-icy1.onrender.com/api/cart', {
                    headers: { 'token': `Bearer ${token}` }
                });
                
                if (!response.ok) throw new Error("Không thể tải giỏ hàng.");
                
                const cartData = await response.json();
                const popup = document.getElementById("cart-popup");
                const list = document.getElementById("cart-items");
                const totalDisplay = document.getElementById("cart-total-display");
                const countDisplay = document.querySelector(".cart-count-display");

                if (!popup || !list) return;

                list.innerHTML = "";
                let total = 0;
                let totalQty = 0;

                if (!cartData.items || cartData.items.length === 0) {
                    list.innerHTML = `
                        <div class="flex flex-col items-center justify-center h-64 text-zinc-500">
                            <i class="fas fa-shopping-basket text-4xl mb-3 opacity-50"></i>
                            <p>Giỏ hàng đang trống</p>
                        </div>`;
                    if(totalDisplay) totalDisplay.textContent = "0₫";
                    if(countDisplay) countDisplay.textContent = "(0)";
                } else {
                    cartData.items.forEach(item => {
                        total += item.price * item.quantity;
                        totalQty += item.quantity;
                        const li = document.createElement("li");
                        li.className = "group relative flex items-start gap-4 p-4 rounded-2xl bg-white/5 border border-white/5 hover:bg-white/10 hover:border-white/10 transition-all duration-200";
                        
                        li.innerHTML = `
                            <div class="w-20 h-20 shrink-0 bg-white rounded-xl p-2 flex items-center justify-center overflow-hidden">
                                <img src="${item.image_url}" alt="${item.name}" class="w-full h-full object-contain" onerror="this.src='images/default.jpg'">
                            </div>
                            <div class="flex-1 min-w-0">
                                <h4 class="text-white font-medium text-sm leading-snug mb-1 truncate">${item.name}</h4>
                                <div class="flex justify-between items-end">
                                    <span class="text-blue-400 font-semibold text-sm">${item.price.toLocaleString('vi-VN')}₫</span>
                                    <span class="text-zinc-500 text-xs">x${item.quantity}</span>
                                </div>
                            </div>
                            <button onclick="removeFromCart('${item.productId}')" class="absolute top-2 right-2 p-2 text-zinc-600 hover:text-red-500 hover:bg-red-500/10 rounded-full transition-colors">
                                <i class="fas fa-trash-alt text-xs"></i>
                            </button>
                        `;
                        list.appendChild(li);
                    });
                    
                    if(totalDisplay) totalDisplay.textContent = total.toLocaleString('vi-VN') + '₫';
                    if(countDisplay) countDisplay.textContent = `(${totalQty})`;
                }
                popup.style.display = '';
                popup.classList.remove('hidden');
                setTimeout(() => popup.classList.remove('translate-x-full'), 10);
            } catch (error) {
                console.error("Lỗi khi mở giỏ hàng:", error);
            }
        }

        function closeCart() {
            const popup = document.getElementById("cart-popup");
            if (popup) {
                popup.classList.add('translate-x-full');
                setTimeout(() => popup.classList.add('hidden'), 300);
            }
        }
        async function removeFromCart(productId) {
            const token = getAuthToken();
            if (!confirm("Bạn có chắc muốn xóa sản phẩm này?")) return;
            try {
                const response = await fetch(`https://project3-icy1.onrender.com/api/cart/item/${productId}`, {
                    method: 'DELETE',
                    headers: { 'token': `Bearer ${token}` }
                });
                if (!response.ok) throw new Error("Lỗi khi xóa sản phẩm.");
                const updatedCart = await response.json();
                updateCartCount(updatedCart.items);
                openCart();
            } catch (error) {
                console.error("Lỗi khi xóa:", error);
            }
        }

        function updateCartCount(items = []) {
            const count = items.reduce((sum, p) => sum + p.quantity, 0);
            const cartCountEl = document.querySelector(".cart-count");
            if(cartCountEl) cartCountEl.textContent = count;
        }

        async function loadInitialCart() {
            const token = getAuthToken();
            if (token) {
                try {
                    const response = await fetch('https://project3-icy1.onrender.com/api/cart', {
                        headers: { 'token': `Bearer ${token}` }
                    });
                    if (response.ok) {
                        const cartData = await response.json();
                        if (cartData && cartData.items) {
                           updateCartCount(cartData.items);
                        }
                    }
                } catch (error) {
                    console.error("Không thể tải giỏ hàng ban đầu:", error);
                }
            }
        }
        // Event Listeners
        const cartContainer = document.querySelector(".cart-container");
        if(cartContainer) cartContainer.addEventListener("click", openCart);

        document.addEventListener('DOMContentLoaded', () => {
            loadInitialCart();
            updateLoginStatusUI();
        });
    </script>
<script>
        // Product Detail Modal Functions
        function showProductDetails(el) {
            const popupContainer = document.getElementById("popup-container");
            if (!popupContainer) return;

            const name = el.dataset.name || '';
            const price = el.dataset.price || '';
            const desc = el.dataset.desc || '';
            const specs = (el.dataset.spec || '').split(",").map(s => s.trim()).filter(s => s);
            
            const imagesAttr = el.dataset.images || el.dataset.img;
            currentImageSet = imagesAttr.split(',').map(img => img.trim());
            
            // Color Map Handling
            const colorMapAttr = el.dataset.colorMap;
            const colorSelector = document.getElementById("modalColorSelector");
            currentColorMap = [];
            
            if (colorMapAttr && colorSelector) {
                try {
                    currentColorMap = JSON.parse(colorMapAttr);
                    colorSelector.innerHTML = '<p class="color-selector-label">Color</p>';
                    const swatchContainer = document.createElement('div');
                    swatchContainer.className = 'swatch-container';

                    currentColorMap.forEach(color => {
                        const swatch = document.createElement('span');
                        swatch.className = 'color-swatch';
                        swatch.style.backgroundColor = color.code;
                        swatch.title = color.name;
                        swatch.dataset.img = color.img;
                        swatch.onclick = () => {
                            const imgIndex = currentImageSet.indexOf(color.img);
                            if (imgIndex !== -1) {
                                setCurrentImage(imgIndex);
                            }
                        };
                        swatchContainer.appendChild(swatch);
                    });
                    colorSelector.appendChild(swatchContainer);
                    colorSelector.style.display = 'block';

                } catch (e) {
                    console.error("Invalid JSON in data-color-map:", e);
                    colorSelector.style.display = 'none';
                }
            } else if (colorSelector) {
                colorSelector.style.display = 'none';
                colorSelector.innerHTML = '';
            }

            // UI Population
            const modalName = document.getElementById("modalName");
            const modalPrice = document.getElementById("modalPrice");
            const modalDesc = document.getElementById("modalDesc");
            const modalSpecList = document.getElementById("modalSpec");
            const thumbnailContainer = document.getElementById("thumbnail-container");

            if (modalName) modalName.textContent = name;
            if (modalPrice) modalPrice.textContent = price;
            if (modalDesc) modalDesc.textContent = desc;

            if (modalSpecList) {
                modalSpecList.innerHTML = "";
                specs.forEach(spec => {
                    let li = document.createElement("li");
                    li.textContent = spec;
                    modalSpecList.appendChild(li);
                });
            }

            if (thumbnailContainer) {
                thumbnailContainer.innerHTML = '';
                currentImageSet.forEach((imgSrc, index) => {
                    const thumb = document.createElement('img');
                    thumb.src = imgSrc;
                    thumb.alt = `${name} thumbnail ${index + 1}`;
                    thumb.onclick = () => setCurrentImage(index);
                    thumbnailContainer.appendChild(thumb);
                });
            }

            setCurrentImage(0);
            popupContainer.classList.add("active");
        }

        function setCurrentImage(index) {
            const mainImg = document.getElementById("modalMainImg");
            const thumbnails = document.querySelectorAll("#thumbnail-container img");

            if (!mainImg || index < 0 || index >= currentImageSet.length) return;
            
            currentImageIndex = index;
            const currentImgSrc = currentImageSet[currentImageIndex];
            mainImg.src = currentImgSrc;

            thumbnails.forEach((thumb, i) => {
                thumb.classList.toggle('active', i === currentImageIndex);
            });

            const swatches = document.querySelectorAll("#modalColorSelector .color-swatch");
            swatches.forEach(swatch => {
                swatch.classList.toggle('active', swatch.dataset.img === currentImgSrc);
            });
        }

        function changeImage(direction) {
            let newIndex = currentImageIndex + direction;
            if (newIndex < 0) {
                newIndex = currentImageSet.length - 1;
            } else if (newIndex >= currentImageSet.length) {
                newIndex = 0;
            }
            setCurrentImage(newIndex);
        }

        function closeModal() {
            const popupContainer = document.getElementById("popup-container");
            if (popupContainer) popupContainer.classList.remove("active");
        }
    </script>

    <!-- JavaScript - Part 4: Accordion Section -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const newAccordionItems = document.querySelectorAll('.new-accordion-design .accordion-item-new');
            const mainAccordionImage = document.getElementById('accordion-main-image');

            if (newAccordionItems.length > 0 && mainAccordionImage) {
                function activateItem(itemToActivate) {
                    if (!itemToActivate) return;

                    const newImageSrc = itemToActivate.dataset.imageSrc;

                    if (newImageSrc && mainAccordionImage.src !== newImageSrc) {
                        mainAccordionImage.style.opacity = 0;
                        setTimeout(() => {
                            mainAccordionImage.src = newImageSrc;
                            mainAccordionImage.alt = itemToActivate.querySelector('.accordion-header-new').textContent.trim();
                            mainAccordionImage.style.opacity = 1;
                        }, 200);
                    } else if (newImageSrc && mainAccordionImage.src === newImageSrc && mainAccordionImage.style.opacity === "0") {
                         mainAccordionImage.style.opacity = 1;
                    }

                    newAccordionItems.forEach(item => {
                        const content = item.querySelector('.accordion-content-new');
                        if (item === itemToActivate) {
                            item.classList.add('active');
                            if (content) content.style.display = 'block';
                        } else {
                            item.classList.remove('active');
                            if (content) content.style.display = 'none';
                        }
                    });
                }

                const firstItem = newAccordionItems[0];
                if (firstItem) {
                    mainAccordionImage.style.opacity = 0;
                    const firstImageSrc = firstItem.dataset.imageSrc;
                    if (firstImageSrc) {
                        mainAccordionImage.src = firstImageSrc; 
                        setTimeout(() => {
                            activateItem(firstItem);
                        }, 50);
                    } else {
                         activateItem(firstItem); 
                    }
                }

                newAccordionItems.forEach(item => {
                    const header = item.querySelector('.accordion-header-new');
                    if (header) {
                        header.addEventListener('click', () => {
                            activateItem(item);
                        });
                    }
                });
            }
        });
    </script>
    <script>
        const heroSection = document.querySelector('.hero');
        const itemSection = document.querySelector('.item');
        const searchResultsSectionForSearchbar = document.getElementById('search-results-section');

        function toggleMainContent(show) {
            const displayValue = show ? '' : 'none';

            if (heroSection) heroSection.style.display = displayValue;
            if (itemSection) itemSection.style.display = displayValue;

            const accordionSection = document.querySelector('.new-accordion-design');
            const comparisonSection = document.querySelector('.iphone-comparison-2');
            if (accordionSection) accordionSection.style.display = displayValue;
            if (comparisonSection) comparisonSection.style.display = displayValue;

            if (searchResultsSectionForSearchbar) {
                searchResultsSectionForSearchbar.style.display = show ? 'none' : 'block';
            }
        }

        function displayProductsForSearchbar(products) {
            const productListContainer = document.getElementById('search-results-list');

            if (!productListContainer || !searchResultsSectionForSearchbar) {
                console.error("Search results container or section not found!");
                return;
            }
            productListContainer.innerHTML = '';

            if (!products || products.length === 0) {
                productListContainer.innerHTML = '<p style="text-align: center; grid-column: 1 / -1; width: 100%;">No matching products found.</p>';
                if (searchResultsSectionForSearchbar) searchResultsSectionForSearchbar.style.display = 'block';
                toggleMainContent(false);
                return;
            }

            products.forEach(product => {
                const productName = product.name || 'Sản phẩm không tên';
                const productPrice = product.price ? product.price.toLocaleString('vi-VN') + '₫' : 'Giá liên hệ';
                const productShortDesc = product.short_description || '';
                const productSpec = product.spec || '';
                const productImageUrl = product.image_url || 'images/default.jpg';
                const productCategory = product.category || 'Chung';

                const productHtml = `
                    <li>
                        <div class="product-item"
                             onclick="showProductDetails(this)"
                             data-name="${productName}"
                             data-price="${productPrice}"
                             data-desc="${productShortDesc}"
                             data-spec="${productSpec}"
                             data-img="${productImageUrl}">
                          <div class="product-image">
                            <img src="${productImageUrl}" alt="${productName}">
                          </div>
                          <div class="product-info">
                            <a href="#" class="product-cat">${productCategory}</a>
                            <a href="#" class="product-name">${productName}</a>
                            <div class="product-price">${productPrice}</div>
                            <button onclick="event.stopPropagation(); addToCart(
                                '${productName.replace(/'/g, "\\'")}',
                                '${productCategory.replace(/'/g, "\\'")}',
                                '${productPrice.replace(/'/g, "\\'")}',
                                '${productImageUrl.replace(/'/g, "\\'")}'
                            )">Add to cart</button>
                          </div>
                        </div>
                    </li>
                `;
                productListContainer.innerHTML += productHtml;
            });
            if (searchResultsSectionForSearchbar) searchResultsSectionForSearchbar.style.display = 'block';
            toggleMainContent(false);
        }

        const backendBaseUrl = 'https://project3-icy1.onrender.com';

        async function performSearch(searchTerm) {
            const trimmedSearchTerm = searchTerm.trim();
            const productListContainer = document.getElementById('search-results-list');

            if (!productListContainer || !searchResultsSectionForSearchbar) {
                console.error("Search results container or section not found for performSearch!");
                return;
            }

            if (!trimmedSearchTerm) {
                productListContainer.innerHTML = '';
                if(searchResultsSectionForSearchbar) searchResultsSectionForSearchbar.style.display = 'none';
                toggleMainContent(true);
                return;
            }

            if(searchResultsSectionForSearchbar) searchResultsSectionForSearchbar.style.display = 'block';
            productListContainer.innerHTML = '<p style="text-align: center; grid-column: 1 / -1; width: 100%;">Searching...</p>';
            toggleMainContent(false);

            try {
                const apiUrl = `${backendBaseUrl}/api/products/search?q=${encodeURIComponent(trimmedSearchTerm)}`;
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `Lỗi HTTP: ${response.status}`);
                }
                const data = await response.json();
                if (data && Array.isArray(data.products)) {
                    displayProductsForSearchbar(data.products);
                } else {
                    console.error('Dữ liệu API trả về không đúng cấu trúc:', data);
                    productListContainer.innerHTML = '<p style="text-align: center; grid-column: 1 / -1; width: 100%;">Đã xảy ra lỗi khi xử lý kết quả tìm kiếm.</p>';
                }
            } catch (error) {
                console.error('Lỗi khi gọi API tìm kiếm:', error);
                productListContainer.innerHTML = `<p style="text-align: center; grid-column: 1 / -1; width: 100%;">Đã xảy ra lỗi khi tìm kiếm: ${error.message}</p>`;
            }
        }

        const searchInput = document.querySelector('.search-input');
        const searchBtn = document.querySelector('.search-btn');

        if (searchInput && searchBtn) {
            searchInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    const searchTerm = searchInput.value;
                    performSearch(searchTerm);
                    if (typeof hideSuggestions === 'function') hideSuggestions();
                }
            });

            searchBtn.addEventListener('click', (event) => {
                event.preventDefault();
                const searchTerm = searchInput.value;
                performSearch(searchTerm);
                if (typeof hideSuggestions === 'function') hideSuggestions();
            });
        }

        function debounce(func, delay) {
            let timeoutId;
            return function (...args) {
                const context = this;
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => {
                    func.apply(context, args);
                }, delay);
            };
        }

        const suggestionsContainer = document.getElementById('suggestions-container');
        const suggestionsList = document.getElementById('suggestions-list');

        function hideSuggestions() {
            if (suggestionsList) suggestionsList.innerHTML = '';
            if (suggestionsContainer) suggestionsContainer.style.display = 'none';
        }

        function showSuggestions() {
            if (suggestionsContainer && suggestionsList && suggestionsList.children.length > 0) {
                 suggestionsContainer.style.display = 'block';
            } else if (suggestionsContainer) {
                suggestionsContainer.style.display = 'none';
            }
        }

        function displaySuggestions(products) {
            if (!suggestionsList) return;
            suggestionsList.innerHTML = '';

            if (!products || products.length === 0) {
                hideSuggestions();
                return;
            }

            products.forEach(product => {
                const li = document.createElement('li');
                const productName = product.name || 'Sản phẩm không tên';
                const productImageUrl = product.image_url || 'images/default.jpg';

                li.innerHTML = `
                    <img src="${productImageUrl}" alt="${productName}" class="suggestion-item-image">
                    <span class="suggestion-item-name">${productName}</span>
                `;

                li.onclick = () => {
                    if(searchInput) searchInput.value = productName;
                    hideSuggestions();
                    performSearch(productName);
                };
                suggestionsList.appendChild(li);
            });
            showSuggestions();
        }

        const fetchAndDisplaySuggestions = debounce(async (searchTerm) => {
            const trimmedSearchTerm = searchTerm.trim();
            if (!trimmedSearchTerm || trimmedSearchTerm.length < 2) { 
                hideSuggestions();
                return;
            }
            try {
                const apiUrl = `${backendBaseUrl}/api/products/search?q=${encodeURIComponent(trimmedSearchTerm)}&limit=5`;
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    console.error('Lỗi khi gọi API gợi ý:', response.status);
                    hideSuggestions();
                    return;
                }
                const data = await response.json();
                if (data && Array.isArray(data.products)) {
                    displaySuggestions(data.products);
                } else {
                    console.error('Dữ liệu API gợi ý trả về không đúng cấu trúc:', data);
                    hideSuggestions();
                }
            } catch (error) {
                console.error('Lỗi fetch gợi ý:', error);
                hideSuggestions();
            }
        }, 300);

        if (searchInput) {
            searchInput.addEventListener('input', () => {
                const searchTerm = searchInput.value;
                fetchAndDisplaySuggestions(searchTerm);
            });

            document.addEventListener('click', (event) => {
                const searchContainer = document.querySelector('.search-container');
                if (searchContainer && !searchContainer.contains(event.target) && suggestionsContainer && event.target !== searchInput) {
                    hideSuggestions();
                }
            });

            searchInput.addEventListener('blur', () => {
                setTimeout(hideSuggestions, 150);
            });

            searchInput.addEventListener('focus', () => {
                const searchTerm = searchInput.value.trim();
                if (searchTerm && searchTerm.length >= 2 && suggestionsList && suggestionsList.children.length > 0) {
                    showSuggestions();
                }
            });
        }
    </script>

    <!-- JavaScript - Part 6: Payment Modal -->
    <script>
        let currentProductPriceIndex = 0;
        let currentDiscountIndex = 0;

        function openPaymentFormIndex(productName, productPrice) {
            const paymentOverlay = document.getElementById('payment-modal-overlay-index'); 

            const productNameEl = document.getElementById('payment-product-name-index');
            const productPriceEl = document.getElementById('payment-product-price-index');
            const totalAmountEl = document.getElementById('total-amount-index');

            if (productNameEl) productNameEl.textContent = productName;
            if (productPriceEl) productPriceEl.textContent = "Giá: " + productPrice;
            if (totalAmountEl) totalAmountEl.textContent = productPrice; 

            if (paymentOverlay) {
                paymentOverlay.classList.add('active');
            } else {
                console.error("Lỗi: Không tìm thấy phần tử overlay với ID 'payment-modal-overlay-index'!");
            }
        }

        function closePaymentFormIndex() {
            const paymentOverlay = document.getElementById('payment-modal-overlay-index');
            if (paymentOverlay) {
                paymentOverlay.classList.remove('active');
            }
        }

        function applyVoucherIndex() {
            // Placeholder function for voucher application
            console.log("Apply voucher functionality");
        }

        document.addEventListener('DOMContentLoaded', () => {
            const paymentFormIndexElement = document.getElementById('paymentFormIndex');

            if (paymentFormIndexElement) {
                paymentFormIndexElement.addEventListener('submit', function(event) {
                    event.preventDefault(); 

                    const recipientName = document.getElementById('recipient-name-index')?.value.trim();
                    const recipientPhone = document.getElementById('recipient-phone-index')?.value.trim();
                    const recipientAddress = document.getElementById('recipient-address-index')?.value.trim();
                    const recipientNotes = document.getElementById('recipient-notes-index')?.value.trim();
                    
                    const paymentMethodChecked = document.querySelector('input[name="payment-method-index"]:checked');
                    const paymentMethod = paymentMethodChecked ? paymentMethodChecked.value : null;

                    const productName = document.getElementById('payment-product-name-index')?.textContent;
                    const productPriceString = document.getElementById('total-amount-index')?.textContent; 
                    
                    const numericPrice = parseFloat(String(productPriceString).replace(/[^\d]/g, ''));

                    if (!recipientName) {
                        alert('Vui lòng nhập tên người nhận.');
                        document.getElementById('recipient-name-index')?.focus();
                        return;
                    }
                    if (!recipientPhone) {
                        alert('Vui lòng nhập số điện thoại.');
                        document.getElementById('recipient-phone-index')?.focus();
                        return;
                    }
                    if (!/^\d{10,11}$/.test(recipientPhone)) {
                        alert('Số điện thoại không hợp lệ. Vui lòng nhập 10 hoặc 11 chữ số.');
                        document.getElementById('recipient-phone-index')?.focus();
                        return;
                    }
                    if (!recipientAddress) {
                        alert('Vui lòng nhập địa chỉ.');
                        document.getElementById('recipient-address-index')?.focus();
                        return;
                    }
                    if (!paymentMethod) {
                        alert('Vui lòng chọn phương thức thanh toán.');
                        return;
                    }

                    const orderData = {
                        recipientName: recipientName,
                        recipientPhone: recipientPhone,
                        recipientAddress: recipientAddress,
                        recipientNotes: recipientNotes,
                        paymentMethod: paymentMethod,
                        items: [{ 
                            name: productName,
                            price: productPriceString,
                            qty: 1,
                        }],
                        totalAmountString: productPriceString,
                        totalAmountNumeric: isNaN(numericPrice) ? 0 : numericPrice
                    };

                    console.log('Đang gửi dữ liệu đơn hàng từ index modal:', orderData);

                    fetch('https://project3-icy1.onrender.com/api/orders', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(orderData),
                    })
                    .then(response => {
                        if (!response.ok) {
                            return response.json().then(errData => {
                                throw new Error(errData.message || `Lỗi HTTP: ${response.status}`);
                            }).catch(() => {
                                throw new Error(`Lỗi HTTP: ${response.status}`);
                            });
                        }
                        return response.json();
                    })
                    .then(data => {
                        alert(data.message || 'Đặt hàng thành công!'); 
                        if (data.orderId) {
                            console.log('Đặt hàng thành công! Mã đơn hàng:', data.orderId);
                        }
                        closePaymentFormIndex();
                        
                        document.getElementById('recipient-name-index').value = '';
                        document.getElementById('recipient-phone-index').value = '';
                        document.getElementById('recipient-address-index').value = '';
                        document.getElementById('recipient-notes-index').value = '';
                        if(document.getElementById('cod-payment-index')) document.getElementById('cod-payment-index').checked = true;

                    })
                    .catch(error => {
                        console.error('Lỗi khi gửi đơn hàng từ index modal:', error);
                        alert('Đã có lỗi xảy ra trong quá trình đặt hàng: ' + error.message);
                    });
                });
            }

            document.addEventListener('keydown', function(event) {
                const paymentOverlay = document.getElementById('payment-modal-overlay-index');
                if (event.key === 'Escape' && paymentOverlay && paymentOverlay.classList.contains('active')) {
                    closePaymentFormIndex();
                }
            });
        });
    </script>

    <!-- JavaScript - Part 7: Chat Functions -->
    <script>
        function toggleChat() {
            const chatWindow = document.getElementById('chat-window');
            if (chatWindow.style.display === 'none' || chatWindow.style.display === '') {
                chatWindow.style.display = 'flex';
                document.getElementById('chat-input-text').focus();
            } else {
                chatWindow.style.display = 'none';
            }
        }

        async function sendChat() {
            const input = document.getElementById('chat-input-text');
            const area = document.getElementById('messages-area');
            const text = input.value.trim();
            const token = localStorage.getItem('accessToken');

            if (!text) return;
            
            if (!token) {
                alert("Bạn vui lòng Đăng nhập để chat với nhân viên hỗ trợ nhé!");
                return;
            }

            area.innerHTML += `<div class="msg user">${text}</div>`;
            input.value = '';
            area.scrollTop = area.scrollHeight;

            const loadingId = 'loading-' + Date.now();
            area.innerHTML += `<div id="${loadingId}" class="msg bot">...</div>`;
            area.scrollTop = area.scrollHeight;

            try {
                const res = await fetch('https://project3-icy1.onrender.com/api/chat', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json', 
                        'token': 'Bearer ' + token 
                    },
                    body: JSON.stringify({ message: text })
                });
                
                const data = await res.json();

                const loadingElement = document.getElementById(loadingId);
                if (loadingElement) loadingElement.remove();
                
                area.innerHTML += `<div class="msg bot">${data.reply}</div>`;
            } catch (e) {
                const loadingElement = document.getElementById(loadingId);
                if (loadingElement) loadingElement.remove();
                area.innerHTML += `<div class="msg bot" style="color:red">Lỗi kết nối server!</div>`;
                console.error(e);
            }
            area.scrollTop = area.scrollHeight;
        }
    </script>

    <!-- Three.js Script Placeholder -->
    <script src="Three.js"></script>

</body>
</html>